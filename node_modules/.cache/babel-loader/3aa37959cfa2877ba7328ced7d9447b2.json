{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nimport { useEffect, useRef, useState } from 'react';\nimport useMemoizedFn from '../useMemoizedFn';\nimport usePagination from '../usePagination';\nimport useUpdateEffect from '../useUpdateEffect';\n\nvar useAntdTable = function useAntdTable(service, options) {\n  var _a;\n\n  if (options === void 0) {\n    options = {};\n  }\n\n  var form = options.form,\n      _b = options.defaultType,\n      defaultType = _b === void 0 ? 'simple' : _b,\n      defaultParams = options.defaultParams,\n      _c = options.manual,\n      manual = _c === void 0 ? false : _c,\n      _d = options.refreshDeps,\n      refreshDeps = _d === void 0 ? [] : _d,\n      _e = options.ready,\n      ready = _e === void 0 ? true : _e,\n      rest = __rest(options, [\"form\", \"defaultType\", \"defaultParams\", \"manual\", \"refreshDeps\", \"ready\"]);\n\n  var result = usePagination(service, __assign({\n    manual: true\n  }, rest));\n  var _f = result.params,\n      params = _f === void 0 ? [] : _f,\n      run = result.run;\n  var cacheFormTableData = params[2] || {};\n\n  var _g = __read(useState((cacheFormTableData === null || cacheFormTableData === void 0 ? void 0 : cacheFormTableData.type) || defaultType), 2),\n      type = _g[0],\n      setType = _g[1];\n\n  var allFormDataRef = useRef({});\n  var isAntdV4 = !!(form === null || form === void 0 ? void 0 : form.getInternalHooks); // get current active field values\n\n  var getActivetFieldValues = function getActivetFieldValues() {\n    if (!form) {\n      return {};\n    } // antd 4\n\n\n    if (isAntdV4) {\n      return form.getFieldsValue(null, function () {\n        return true;\n      });\n    } // antd 3\n\n\n    var allFieldsValue = form.getFieldsValue();\n    var activeFieldsValue = {};\n    Object.keys(allFieldsValue).forEach(function (key) {\n      if (form.getFieldInstance ? form.getFieldInstance(key) : true) {\n        activeFieldsValue[key] = allFieldsValue[key];\n      }\n    });\n    return activeFieldsValue;\n  };\n\n  var validateFields = function validateFields() {\n    if (!form) {\n      return Promise.resolve({});\n    }\n\n    var activeFieldsValue = getActivetFieldValues();\n    var fields = Object.keys(activeFieldsValue); // antd 4\n\n    if (isAntdV4) {\n      return form.validateFields(fields);\n    } // antd 3\n\n\n    return new Promise(function (resolve, reject) {\n      form.validateFields(fields, function (errors, values) {\n        if (errors) {\n          reject(errors);\n        } else {\n          resolve(values);\n        }\n      });\n    });\n  };\n\n  var restoreForm = function restoreForm() {\n    if (!form) {\n      return;\n    } // antd v4\n\n\n    if (isAntdV4) {\n      return form.setFieldsValue(allFormDataRef.current);\n    } // antd v3\n\n\n    var activeFieldsValue = {};\n    Object.keys(allFormDataRef.current).forEach(function (key) {\n      if (form.getFieldInstance ? form.getFieldInstance(key) : true) {\n        activeFieldsValue[key] = allFormDataRef.current[key];\n      }\n    });\n    form.setFieldsValue(activeFieldsValue);\n  };\n\n  var changeType = function changeType() {\n    var activeFieldsValue = getActivetFieldValues();\n    allFormDataRef.current = __assign(__assign({}, allFormDataRef.current), activeFieldsValue);\n    setType(function (t) {\n      return t === 'simple' ? 'advance' : 'simple';\n    });\n  };\n\n  var _submit = function _submit(initPagination) {\n    if (!ready) {\n      return;\n    }\n\n    setTimeout(function () {\n      validateFields().then(function (values) {\n        if (values === void 0) {\n          values = {};\n        }\n\n        var pagination = initPagination || __assign(__assign({\n          pageSize: options.defaultPageSize || 10\n        }, (params === null || params === void 0 ? void 0 : params[0]) || {}), {\n          current: 1\n        });\n\n        if (!form) {\n          // @ts-ignore\n          run(pagination);\n          return;\n        } // record all form data\n\n\n        allFormDataRef.current = __assign(__assign({}, allFormDataRef.current), values); // @ts-ignore\n\n        run(pagination, values, {\n          allFormData: allFormDataRef.current,\n          type: type\n        });\n      })[\"catch\"](function (err) {\n        return err;\n      });\n    });\n  };\n\n  var reset = function reset() {\n    if (form) {\n      form.resetFields();\n    }\n\n    _submit();\n  };\n\n  var submit = function submit(e) {\n    var _a;\n\n    (_a = e === null || e === void 0 ? void 0 : e.preventDefault) === null || _a === void 0 ? void 0 : _a.call(e);\n\n    _submit();\n  };\n\n  var onTableChange = function onTableChange(pagination, filters, sorter) {\n    var _a = __read(params || []),\n        oldPaginationParams = _a[0],\n        restParams = _a.slice(1);\n\n    run.apply(void 0, __spread([__assign(__assign({}, oldPaginationParams), {\n      current: pagination.current,\n      pageSize: pagination.pageSize,\n      filters: filters,\n      sorter: sorter\n    })], restParams));\n  }; // init\n\n\n  useEffect(function () {\n    // if has cache, use cached params. ignore manual and ready.\n    if (params.length > 0) {\n      allFormDataRef.current = (cacheFormTableData === null || cacheFormTableData === void 0 ? void 0 : cacheFormTableData.allFormData) || {};\n      restoreForm(); // @ts-ignore\n\n      run.apply(void 0, __spread(params));\n      return;\n    }\n\n    if (!manual && ready) {\n      allFormDataRef.current = (defaultParams === null || defaultParams === void 0 ? void 0 : defaultParams[1]) || {};\n      restoreForm();\n\n      _submit(defaultParams === null || defaultParams === void 0 ? void 0 : defaultParams[0]);\n    }\n  }, []); // change search type, restore form data\n\n  useUpdateEffect(function () {\n    if (!ready) {\n      return;\n    }\n\n    restoreForm();\n  }, [type]); // refresh & ready change on the same time\n\n  var hasAutoRun = useRef(false);\n  hasAutoRun.current = false;\n  useUpdateEffect(function () {\n    if (!manual && ready) {\n      hasAutoRun.current = true;\n\n      if (form) {\n        form.resetFields();\n      }\n\n      allFormDataRef.current = (defaultParams === null || defaultParams === void 0 ? void 0 : defaultParams[1]) || {};\n      restoreForm();\n\n      _submit(defaultParams === null || defaultParams === void 0 ? void 0 : defaultParams[0]);\n    }\n  }, [ready]);\n  useUpdateEffect(function () {\n    if (hasAutoRun.current) {\n      return;\n    }\n\n    if (!ready) {\n      return;\n    }\n\n    if (!manual) {\n      hasAutoRun.current = true;\n      result.pagination.changeCurrent(1);\n    }\n  }, __spread(refreshDeps));\n  return __assign(__assign({}, result), {\n    tableProps: {\n      dataSource: ((_a = result.data) === null || _a === void 0 ? void 0 : _a.list) || [],\n      loading: result.loading,\n      onChange: useMemoizedFn(onTableChange),\n      pagination: {\n        current: result.pagination.current,\n        pageSize: result.pagination.pageSize,\n        total: result.pagination.total\n      }\n    },\n    search: {\n      submit: useMemoizedFn(submit),\n      type: type,\n      changeType: useMemoizedFn(changeType),\n      reset: useMemoizedFn(reset)\n    }\n  });\n};\n\nexport default useAntdTable;","map":{"version":3,"sources":["D:/react/project0330/node_modules/ahooks/es/useAntdTable/index.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__read","o","m","Symbol","iterator","r","ar","next","done","push","value","error","__spread","concat","useEffect","useRef","useState","useMemoizedFn","usePagination","useUpdateEffect","useAntdTable","service","options","_a","form","_b","defaultType","defaultParams","_c","manual","_d","refreshDeps","_e","ready","rest","result","_f","params","run","cacheFormTableData","_g","type","setType","allFormDataRef","isAntdV4","getInternalHooks","getActivetFieldValues","getFieldsValue","allFieldsValue","activeFieldsValue","keys","forEach","key","getFieldInstance","validateFields","Promise","resolve","fields","reject","errors","values","restoreForm","setFieldsValue","current","changeType","_submit","initPagination","setTimeout","then","pagination","pageSize","defaultPageSize","allFormData","err","reset","resetFields","submit","preventDefault","onTableChange","filters","sorter","oldPaginationParams","restParams","slice","hasAutoRun","changeCurrent","tableProps","dataSource","data","list","loading","onChange","total","search"],"mappings":"AAAA,IAAIA,QAAQ,GAAG,QAAQ,KAAKA,QAAb,IAAyB,YAAY;AAClDA,EAAAA,QAAQ,GAAGC,MAAM,CAACC,MAAP,IAAiB,UAAUC,CAAV,EAAa;AACvC,SAAK,IAAIC,CAAJ,EAAOC,CAAC,GAAG,CAAX,EAAcC,CAAC,GAAGC,SAAS,CAACC,MAAjC,EAAyCH,CAAC,GAAGC,CAA7C,EAAgDD,CAAC,EAAjD,EAAqD;AACnDD,MAAAA,CAAC,GAAGG,SAAS,CAACF,CAAD,CAAb;;AAEA,WAAK,IAAII,CAAT,IAAcL,CAAd,EAAiB;AACf,YAAIH,MAAM,CAACS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EAAgDN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AACjD;AACF;;AAED,WAAON,CAAP;AACD,GAVD;;AAYA,SAAOH,QAAQ,CAACa,KAAT,CAAe,IAAf,EAAqBN,SAArB,CAAP;AACD,CAdD;;AAgBA,IAAIO,MAAM,GAAG,QAAQ,KAAKA,MAAb,IAAuB,UAAUV,CAAV,EAAaW,CAAb,EAAgB;AAClD,MAAIZ,CAAC,GAAG,EAAR;;AAEA,OAAK,IAAIM,CAAT,IAAcL,CAAd,EAAiB;AACf,QAAIH,MAAM,CAACS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,KAA8CM,CAAC,CAACC,OAAF,CAAUP,CAAV,IAAe,CAAjE,EAAoEN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AACrE;;AAED,MAAIL,CAAC,IAAI,IAAL,IAAa,OAAOH,MAAM,CAACgB,qBAAd,KAAwC,UAAzD,EAAqE,KAAK,IAAIZ,CAAC,GAAG,CAAR,EAAWI,CAAC,GAAGR,MAAM,CAACgB,qBAAP,CAA6Bb,CAA7B,CAApB,EAAqDC,CAAC,GAAGI,CAAC,CAACD,MAA3D,EAAmEH,CAAC,EAApE,EAAwE;AAC3I,QAAIU,CAAC,CAACC,OAAF,CAAUP,CAAC,CAACJ,CAAD,CAAX,IAAkB,CAAlB,IAAuBJ,MAAM,CAACS,SAAP,CAAiBQ,oBAAjB,CAAsCN,IAAtC,CAA2CR,CAA3C,EAA8CK,CAAC,CAACJ,CAAD,CAA/C,CAA3B,EAAgFF,CAAC,CAACM,CAAC,CAACJ,CAAD,CAAF,CAAD,GAAUD,CAAC,CAACK,CAAC,CAACJ,CAAD,CAAF,CAAX;AACjF;AACD,SAAOF,CAAP;AACD,CAXD;;AAaA,IAAIgB,MAAM,GAAG,QAAQ,KAAKA,MAAb,IAAuB,UAAUC,CAAV,EAAad,CAAb,EAAgB;AAClD,MAAIe,CAAC,GAAG,OAAOC,MAAP,KAAkB,UAAlB,IAAgCF,CAAC,CAACE,MAAM,CAACC,QAAR,CAAzC;AACA,MAAI,CAACF,CAAL,EAAQ,OAAOD,CAAP;AACR,MAAIf,CAAC,GAAGgB,CAAC,CAACT,IAAF,CAAOQ,CAAP,CAAR;AAAA,MACII,CADJ;AAAA,MAEIC,EAAE,GAAG,EAFT;AAAA,MAGIV,CAHJ;;AAKA,MAAI;AACF,WAAO,CAACT,CAAC,KAAK,KAAK,CAAX,IAAgBA,CAAC,KAAK,CAAvB,KAA6B,CAAC,CAACkB,CAAC,GAAGnB,CAAC,CAACqB,IAAF,EAAL,EAAeC,IAApD,EAA0D;AACxDF,MAAAA,EAAE,CAACG,IAAH,CAAQJ,CAAC,CAACK,KAAV;AACD;AACF,GAJD,CAIE,OAAOC,KAAP,EAAc;AACdf,IAAAA,CAAC,GAAG;AACFe,MAAAA,KAAK,EAAEA;AADL,KAAJ;AAGD,GARD,SAQU;AACR,QAAI;AACF,UAAIN,CAAC,IAAI,CAACA,CAAC,CAACG,IAAR,KAAiBN,CAAC,GAAGhB,CAAC,CAAC,QAAD,CAAtB,CAAJ,EAAuCgB,CAAC,CAACT,IAAF,CAAOP,CAAP;AACxC,KAFD,SAEU;AACR,UAAIU,CAAJ,EAAO,MAAMA,CAAC,CAACe,KAAR;AACR;AACF;;AAED,SAAOL,EAAP;AACD,CAzBD;;AA2BA,IAAIM,QAAQ,GAAG,QAAQ,KAAKA,QAAb,IAAyB,YAAY;AAClD,OAAK,IAAIN,EAAE,GAAG,EAAT,EAAapB,CAAC,GAAG,CAAtB,EAAyBA,CAAC,GAAGE,SAAS,CAACC,MAAvC,EAA+CH,CAAC,EAAhD,EAAoD;AAClDoB,IAAAA,EAAE,GAAGA,EAAE,CAACO,MAAH,CAAUb,MAAM,CAACZ,SAAS,CAACF,CAAD,CAAV,CAAhB,CAAL;AACD;;AAED,SAAOoB,EAAP;AACD,CAND;;AAQA,SAASQ,SAAT,EAAoBC,MAApB,EAA4BC,QAA5B,QAA4C,OAA5C;AACA,OAAOC,aAAP,MAA0B,kBAA1B;AACA,OAAOC,aAAP,MAA0B,kBAA1B;AACA,OAAOC,eAAP,MAA4B,oBAA5B;;AAEA,IAAIC,YAAY,GAAG,SAASA,YAAT,CAAsBC,OAAtB,EAA+BC,OAA/B,EAAwC;AACzD,MAAIC,EAAJ;;AAEA,MAAID,OAAO,KAAK,KAAK,CAArB,EAAwB;AACtBA,IAAAA,OAAO,GAAG,EAAV;AACD;;AAED,MAAIE,IAAI,GAAGF,OAAO,CAACE,IAAnB;AAAA,MACIC,EAAE,GAAGH,OAAO,CAACI,WADjB;AAAA,MAEIA,WAAW,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgB,QAAhB,GAA2BA,EAF7C;AAAA,MAGIE,aAAa,GAAGL,OAAO,CAACK,aAH5B;AAAA,MAIIC,EAAE,GAAGN,OAAO,CAACO,MAJjB;AAAA,MAKIA,MAAM,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgB,KAAhB,GAAwBA,EALrC;AAAA,MAMIE,EAAE,GAAGR,OAAO,CAACS,WANjB;AAAA,MAOIA,WAAW,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgB,EAAhB,GAAqBA,EAPvC;AAAA,MAQIE,EAAE,GAAGV,OAAO,CAACW,KARjB;AAAA,MASIA,KAAK,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgB,IAAhB,GAAuBA,EATnC;AAAA,MAUIE,IAAI,GAAGvC,MAAM,CAAC2B,OAAD,EAAU,CAAC,MAAD,EAAS,aAAT,EAAwB,eAAxB,EAAyC,QAAzC,EAAmD,aAAnD,EAAkE,OAAlE,CAAV,CAVjB;;AAYA,MAAIa,MAAM,GAAGjB,aAAa,CAACG,OAAD,EAAUxC,QAAQ,CAAC;AAC3CgD,IAAAA,MAAM,EAAE;AADmC,GAAD,EAEzCK,IAFyC,CAAlB,CAA1B;AAGA,MAAIE,EAAE,GAAGD,MAAM,CAACE,MAAhB;AAAA,MACIA,MAAM,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgB,EAAhB,GAAqBA,EADlC;AAAA,MAEIE,GAAG,GAAGH,MAAM,CAACG,GAFjB;AAGA,MAAIC,kBAAkB,GAAGF,MAAM,CAAC,CAAD,CAAN,IAAa,EAAtC;;AAEA,MAAIG,EAAE,GAAGxC,MAAM,CAACgB,QAAQ,CAAC,CAACuB,kBAAkB,KAAK,IAAvB,IAA+BA,kBAAkB,KAAK,KAAK,CAA3D,GAA+D,KAAK,CAApE,GAAwEA,kBAAkB,CAACE,IAA5F,KAAqGf,WAAtG,CAAT,EAA6H,CAA7H,CAAf;AAAA,MACIe,IAAI,GAAGD,EAAE,CAAC,CAAD,CADb;AAAA,MAEIE,OAAO,GAAGF,EAAE,CAAC,CAAD,CAFhB;;AAIA,MAAIG,cAAc,GAAG5B,MAAM,CAAC,EAAD,CAA3B;AACA,MAAI6B,QAAQ,GAAG,CAAC,EAAEpB,IAAI,KAAK,IAAT,IAAiBA,IAAI,KAAK,KAAK,CAA/B,GAAmC,KAAK,CAAxC,GAA4CA,IAAI,CAACqB,gBAAnD,CAAhB,CAhCyD,CAgC6B;;AAEtF,MAAIC,qBAAqB,GAAG,SAASA,qBAAT,GAAiC;AAC3D,QAAI,CAACtB,IAAL,EAAW;AACT,aAAO,EAAP;AACD,KAH0D,CAGzD;;;AAGF,QAAIoB,QAAJ,EAAc;AACZ,aAAOpB,IAAI,CAACuB,cAAL,CAAoB,IAApB,EAA0B,YAAY;AAC3C,eAAO,IAAP;AACD,OAFM,CAAP;AAGD,KAV0D,CAUzD;;;AAGF,QAAIC,cAAc,GAAGxB,IAAI,CAACuB,cAAL,EAArB;AACA,QAAIE,iBAAiB,GAAG,EAAxB;AACAnE,IAAAA,MAAM,CAACoE,IAAP,CAAYF,cAAZ,EAA4BG,OAA5B,CAAoC,UAAUC,GAAV,EAAe;AACjD,UAAI5B,IAAI,CAAC6B,gBAAL,GAAwB7B,IAAI,CAAC6B,gBAAL,CAAsBD,GAAtB,CAAxB,GAAqD,IAAzD,EAA+D;AAC7DH,QAAAA,iBAAiB,CAACG,GAAD,CAAjB,GAAyBJ,cAAc,CAACI,GAAD,CAAvC;AACD;AACF,KAJD;AAKA,WAAOH,iBAAP;AACD,GArBD;;AAuBA,MAAIK,cAAc,GAAG,SAASA,cAAT,GAA0B;AAC7C,QAAI,CAAC9B,IAAL,EAAW;AACT,aAAO+B,OAAO,CAACC,OAAR,CAAgB,EAAhB,CAAP;AACD;;AAED,QAAIP,iBAAiB,GAAGH,qBAAqB,EAA7C;AACA,QAAIW,MAAM,GAAG3E,MAAM,CAACoE,IAAP,CAAYD,iBAAZ,CAAb,CAN6C,CAMA;;AAE7C,QAAIL,QAAJ,EAAc;AACZ,aAAOpB,IAAI,CAAC8B,cAAL,CAAoBG,MAApB,CAAP;AACD,KAV4C,CAU3C;;;AAGF,WAAO,IAAIF,OAAJ,CAAY,UAAUC,OAAV,EAAmBE,MAAnB,EAA2B;AAC5ClC,MAAAA,IAAI,CAAC8B,cAAL,CAAoBG,MAApB,EAA4B,UAAUE,MAAV,EAAkBC,MAAlB,EAA0B;AACpD,YAAID,MAAJ,EAAY;AACVD,UAAAA,MAAM,CAACC,MAAD,CAAN;AACD,SAFD,MAEO;AACLH,UAAAA,OAAO,CAACI,MAAD,CAAP;AACD;AACF,OAND;AAOD,KARM,CAAP;AASD,GAtBD;;AAwBA,MAAIC,WAAW,GAAG,SAASA,WAAT,GAAuB;AACvC,QAAI,CAACrC,IAAL,EAAW;AACT;AACD,KAHsC,CAGrC;;;AAGF,QAAIoB,QAAJ,EAAc;AACZ,aAAOpB,IAAI,CAACsC,cAAL,CAAoBnB,cAAc,CAACoB,OAAnC,CAAP;AACD,KARsC,CAQrC;;;AAGF,QAAId,iBAAiB,GAAG,EAAxB;AACAnE,IAAAA,MAAM,CAACoE,IAAP,CAAYP,cAAc,CAACoB,OAA3B,EAAoCZ,OAApC,CAA4C,UAAUC,GAAV,EAAe;AACzD,UAAI5B,IAAI,CAAC6B,gBAAL,GAAwB7B,IAAI,CAAC6B,gBAAL,CAAsBD,GAAtB,CAAxB,GAAqD,IAAzD,EAA+D;AAC7DH,QAAAA,iBAAiB,CAACG,GAAD,CAAjB,GAAyBT,cAAc,CAACoB,OAAf,CAAuBX,GAAvB,CAAzB;AACD;AACF,KAJD;AAKA5B,IAAAA,IAAI,CAACsC,cAAL,CAAoBb,iBAApB;AACD,GAlBD;;AAoBA,MAAIe,UAAU,GAAG,SAASA,UAAT,GAAsB;AACrC,QAAIf,iBAAiB,GAAGH,qBAAqB,EAA7C;AACAH,IAAAA,cAAc,CAACoB,OAAf,GAAyBlF,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK8D,cAAc,CAACoB,OAApB,CAAT,EAAuCd,iBAAvC,CAAjC;AACAP,IAAAA,OAAO,CAAC,UAAU1D,CAAV,EAAa;AACnB,aAAOA,CAAC,KAAK,QAAN,GAAiB,SAAjB,GAA6B,QAApC;AACD,KAFM,CAAP;AAGD,GAND;;AAQA,MAAIiF,OAAO,GAAG,SAASA,OAAT,CAAiBC,cAAjB,EAAiC;AAC7C,QAAI,CAACjC,KAAL,EAAY;AACV;AACD;;AAEDkC,IAAAA,UAAU,CAAC,YAAY;AACrBb,MAAAA,cAAc,GAAGc,IAAjB,CAAsB,UAAUR,MAAV,EAAkB;AACtC,YAAIA,MAAM,KAAK,KAAK,CAApB,EAAuB;AACrBA,UAAAA,MAAM,GAAG,EAAT;AACD;;AAED,YAAIS,UAAU,GAAGH,cAAc,IAAIrF,QAAQ,CAACA,QAAQ,CAAC;AACnDyF,UAAAA,QAAQ,EAAEhD,OAAO,CAACiD,eAAR,IAA2B;AADc,SAAD,EAEjD,CAAClC,MAAM,KAAK,IAAX,IAAmBA,MAAM,KAAK,KAAK,CAAnC,GAAuC,KAAK,CAA5C,GAAgDA,MAAM,CAAC,CAAD,CAAvD,KAA+D,EAFd,CAAT,EAE4B;AACrE0B,UAAAA,OAAO,EAAE;AAD4D,SAF5B,CAA3C;;AAMA,YAAI,CAACvC,IAAL,EAAW;AACT;AACAc,UAAAA,GAAG,CAAC+B,UAAD,CAAH;AACA;AACD,SAfqC,CAepC;;;AAGF1B,QAAAA,cAAc,CAACoB,OAAf,GAAyBlF,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAK8D,cAAc,CAACoB,OAApB,CAAT,EAAuCH,MAAvC,CAAjC,CAlBsC,CAkB2C;;AAEjFtB,QAAAA,GAAG,CAAC+B,UAAD,EAAaT,MAAb,EAAqB;AACtBY,UAAAA,WAAW,EAAE7B,cAAc,CAACoB,OADN;AAEtBtB,UAAAA,IAAI,EAAEA;AAFgB,SAArB,CAAH;AAID,OAxBD,EAwBG,OAxBH,EAwBY,UAAUgC,GAAV,EAAe;AACzB,eAAOA,GAAP;AACD,OA1BD;AA2BD,KA5BS,CAAV;AA6BD,GAlCD;;AAoCA,MAAIC,KAAK,GAAG,SAASA,KAAT,GAAiB;AAC3B,QAAIlD,IAAJ,EAAU;AACRA,MAAAA,IAAI,CAACmD,WAAL;AACD;;AAEDV,IAAAA,OAAO;AACR,GAND;;AAQA,MAAIW,MAAM,GAAG,SAASA,MAAT,CAAgBhF,CAAhB,EAAmB;AAC9B,QAAI2B,EAAJ;;AAEA,KAACA,EAAE,GAAG3B,CAAC,KAAK,IAAN,IAAcA,CAAC,KAAK,KAAK,CAAzB,GAA6B,KAAK,CAAlC,GAAsCA,CAAC,CAACiF,cAA9C,MAAkE,IAAlE,IAA0EtD,EAAE,KAAK,KAAK,CAAtF,GAA0F,KAAK,CAA/F,GAAmGA,EAAE,CAAC9B,IAAH,CAAQG,CAAR,CAAnG;;AAEAqE,IAAAA,OAAO;AACR,GAND;;AAQA,MAAIa,aAAa,GAAG,SAASA,aAAT,CAAuBT,UAAvB,EAAmCU,OAAnC,EAA4CC,MAA5C,EAAoD;AACtE,QAAIzD,EAAE,GAAGvB,MAAM,CAACqC,MAAM,IAAI,EAAX,CAAf;AAAA,QACI4C,mBAAmB,GAAG1D,EAAE,CAAC,CAAD,CAD5B;AAAA,QAEI2D,UAAU,GAAG3D,EAAE,CAAC4D,KAAH,CAAS,CAAT,CAFjB;;AAIA7C,IAAAA,GAAG,CAAC5C,KAAJ,CAAU,KAAK,CAAf,EAAkBkB,QAAQ,CAAC,CAAC/B,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKoG,mBAAL,CAAT,EAAoC;AACtElB,MAAAA,OAAO,EAAEM,UAAU,CAACN,OADkD;AAEtEO,MAAAA,QAAQ,EAAED,UAAU,CAACC,QAFiD;AAGtES,MAAAA,OAAO,EAAEA,OAH6D;AAItEC,MAAAA,MAAM,EAAEA;AAJ8D,KAApC,CAAT,CAAD,EAKrBE,UALqB,CAA1B;AAMD,GAXD,CAjKyD,CA4KtD;;;AAGHpE,EAAAA,SAAS,CAAC,YAAY;AACpB;AACA,QAAIuB,MAAM,CAAChD,MAAP,GAAgB,CAApB,EAAuB;AACrBsD,MAAAA,cAAc,CAACoB,OAAf,GAAyB,CAACxB,kBAAkB,KAAK,IAAvB,IAA+BA,kBAAkB,KAAK,KAAK,CAA3D,GAA+D,KAAK,CAApE,GAAwEA,kBAAkB,CAACiC,WAA5F,KAA4G,EAArI;AACAX,MAAAA,WAAW,GAFU,CAEN;;AAEfvB,MAAAA,GAAG,CAAC5C,KAAJ,CAAU,KAAK,CAAf,EAAkBkB,QAAQ,CAACyB,MAAD,CAA1B;AACA;AACD;;AAED,QAAI,CAACR,MAAD,IAAWI,KAAf,EAAsB;AACpBU,MAAAA,cAAc,CAACoB,OAAf,GAAyB,CAACpC,aAAa,KAAK,IAAlB,IAA0BA,aAAa,KAAK,KAAK,CAAjD,GAAqD,KAAK,CAA1D,GAA8DA,aAAa,CAAC,CAAD,CAA5E,KAAoF,EAA7G;AACAkC,MAAAA,WAAW;;AAEXI,MAAAA,OAAO,CAACtC,aAAa,KAAK,IAAlB,IAA0BA,aAAa,KAAK,KAAK,CAAjD,GAAqD,KAAK,CAA1D,GAA8DA,aAAa,CAAC,CAAD,CAA5E,CAAP;AACD;AACF,GAhBQ,EAgBN,EAhBM,CAAT,CA/KyD,CA+LjD;;AAERR,EAAAA,eAAe,CAAC,YAAY;AAC1B,QAAI,CAACc,KAAL,EAAY;AACV;AACD;;AAED4B,IAAAA,WAAW;AACZ,GANc,EAMZ,CAACpB,IAAD,CANY,CAAf,CAjMyD,CAuM7C;;AAEZ,MAAI2C,UAAU,GAAGrE,MAAM,CAAC,KAAD,CAAvB;AACAqE,EAAAA,UAAU,CAACrB,OAAX,GAAqB,KAArB;AACA5C,EAAAA,eAAe,CAAC,YAAY;AAC1B,QAAI,CAACU,MAAD,IAAWI,KAAf,EAAsB;AACpBmD,MAAAA,UAAU,CAACrB,OAAX,GAAqB,IAArB;;AAEA,UAAIvC,IAAJ,EAAU;AACRA,QAAAA,IAAI,CAACmD,WAAL;AACD;;AAEDhC,MAAAA,cAAc,CAACoB,OAAf,GAAyB,CAACpC,aAAa,KAAK,IAAlB,IAA0BA,aAAa,KAAK,KAAK,CAAjD,GAAqD,KAAK,CAA1D,GAA8DA,aAAa,CAAC,CAAD,CAA5E,KAAoF,EAA7G;AACAkC,MAAAA,WAAW;;AAEXI,MAAAA,OAAO,CAACtC,aAAa,KAAK,IAAlB,IAA0BA,aAAa,KAAK,KAAK,CAAjD,GAAqD,KAAK,CAA1D,GAA8DA,aAAa,CAAC,CAAD,CAA5E,CAAP;AACD;AACF,GAbc,EAaZ,CAACM,KAAD,CAbY,CAAf;AAcAd,EAAAA,eAAe,CAAC,YAAY;AAC1B,QAAIiE,UAAU,CAACrB,OAAf,EAAwB;AACtB;AACD;;AAED,QAAI,CAAC9B,KAAL,EAAY;AACV;AACD;;AAED,QAAI,CAACJ,MAAL,EAAa;AACXuD,MAAAA,UAAU,CAACrB,OAAX,GAAqB,IAArB;AACA5B,MAAAA,MAAM,CAACkC,UAAP,CAAkBgB,aAAlB,CAAgC,CAAhC;AACD;AACF,GAbc,EAaZzE,QAAQ,CAACmB,WAAD,CAbI,CAAf;AAcA,SAAOlD,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKsD,MAAL,CAAT,EAAuB;AACpCmD,IAAAA,UAAU,EAAE;AACVC,MAAAA,UAAU,EAAE,CAAC,CAAChE,EAAE,GAAGY,MAAM,CAACqD,IAAb,MAAuB,IAAvB,IAA+BjE,EAAE,KAAK,KAAK,CAA3C,GAA+C,KAAK,CAApD,GAAwDA,EAAE,CAACkE,IAA5D,KAAqE,EADvE;AAEVC,MAAAA,OAAO,EAAEvD,MAAM,CAACuD,OAFN;AAGVC,MAAAA,QAAQ,EAAE1E,aAAa,CAAC6D,aAAD,CAHb;AAIVT,MAAAA,UAAU,EAAE;AACVN,QAAAA,OAAO,EAAE5B,MAAM,CAACkC,UAAP,CAAkBN,OADjB;AAEVO,QAAAA,QAAQ,EAAEnC,MAAM,CAACkC,UAAP,CAAkBC,QAFlB;AAGVsB,QAAAA,KAAK,EAAEzD,MAAM,CAACkC,UAAP,CAAkBuB;AAHf;AAJF,KADwB;AAWpCC,IAAAA,MAAM,EAAE;AACNjB,MAAAA,MAAM,EAAE3D,aAAa,CAAC2D,MAAD,CADf;AAENnC,MAAAA,IAAI,EAAEA,IAFA;AAGNuB,MAAAA,UAAU,EAAE/C,aAAa,CAAC+C,UAAD,CAHnB;AAINU,MAAAA,KAAK,EAAEzD,aAAa,CAACyD,KAAD;AAJd;AAX4B,GAAvB,CAAf;AAkBD,CAzPD;;AA2PA,eAAetD,YAAf","sourcesContent":["var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nimport { useEffect, useRef, useState } from 'react';\nimport useMemoizedFn from '../useMemoizedFn';\nimport usePagination from '../usePagination';\nimport useUpdateEffect from '../useUpdateEffect';\n\nvar useAntdTable = function useAntdTable(service, options) {\n  var _a;\n\n  if (options === void 0) {\n    options = {};\n  }\n\n  var form = options.form,\n      _b = options.defaultType,\n      defaultType = _b === void 0 ? 'simple' : _b,\n      defaultParams = options.defaultParams,\n      _c = options.manual,\n      manual = _c === void 0 ? false : _c,\n      _d = options.refreshDeps,\n      refreshDeps = _d === void 0 ? [] : _d,\n      _e = options.ready,\n      ready = _e === void 0 ? true : _e,\n      rest = __rest(options, [\"form\", \"defaultType\", \"defaultParams\", \"manual\", \"refreshDeps\", \"ready\"]);\n\n  var result = usePagination(service, __assign({\n    manual: true\n  }, rest));\n  var _f = result.params,\n      params = _f === void 0 ? [] : _f,\n      run = result.run;\n  var cacheFormTableData = params[2] || {};\n\n  var _g = __read(useState((cacheFormTableData === null || cacheFormTableData === void 0 ? void 0 : cacheFormTableData.type) || defaultType), 2),\n      type = _g[0],\n      setType = _g[1];\n\n  var allFormDataRef = useRef({});\n  var isAntdV4 = !!(form === null || form === void 0 ? void 0 : form.getInternalHooks); // get current active field values\n\n  var getActivetFieldValues = function getActivetFieldValues() {\n    if (!form) {\n      return {};\n    } // antd 4\n\n\n    if (isAntdV4) {\n      return form.getFieldsValue(null, function () {\n        return true;\n      });\n    } // antd 3\n\n\n    var allFieldsValue = form.getFieldsValue();\n    var activeFieldsValue = {};\n    Object.keys(allFieldsValue).forEach(function (key) {\n      if (form.getFieldInstance ? form.getFieldInstance(key) : true) {\n        activeFieldsValue[key] = allFieldsValue[key];\n      }\n    });\n    return activeFieldsValue;\n  };\n\n  var validateFields = function validateFields() {\n    if (!form) {\n      return Promise.resolve({});\n    }\n\n    var activeFieldsValue = getActivetFieldValues();\n    var fields = Object.keys(activeFieldsValue); // antd 4\n\n    if (isAntdV4) {\n      return form.validateFields(fields);\n    } // antd 3\n\n\n    return new Promise(function (resolve, reject) {\n      form.validateFields(fields, function (errors, values) {\n        if (errors) {\n          reject(errors);\n        } else {\n          resolve(values);\n        }\n      });\n    });\n  };\n\n  var restoreForm = function restoreForm() {\n    if (!form) {\n      return;\n    } // antd v4\n\n\n    if (isAntdV4) {\n      return form.setFieldsValue(allFormDataRef.current);\n    } // antd v3\n\n\n    var activeFieldsValue = {};\n    Object.keys(allFormDataRef.current).forEach(function (key) {\n      if (form.getFieldInstance ? form.getFieldInstance(key) : true) {\n        activeFieldsValue[key] = allFormDataRef.current[key];\n      }\n    });\n    form.setFieldsValue(activeFieldsValue);\n  };\n\n  var changeType = function changeType() {\n    var activeFieldsValue = getActivetFieldValues();\n    allFormDataRef.current = __assign(__assign({}, allFormDataRef.current), activeFieldsValue);\n    setType(function (t) {\n      return t === 'simple' ? 'advance' : 'simple';\n    });\n  };\n\n  var _submit = function _submit(initPagination) {\n    if (!ready) {\n      return;\n    }\n\n    setTimeout(function () {\n      validateFields().then(function (values) {\n        if (values === void 0) {\n          values = {};\n        }\n\n        var pagination = initPagination || __assign(__assign({\n          pageSize: options.defaultPageSize || 10\n        }, (params === null || params === void 0 ? void 0 : params[0]) || {}), {\n          current: 1\n        });\n\n        if (!form) {\n          // @ts-ignore\n          run(pagination);\n          return;\n        } // record all form data\n\n\n        allFormDataRef.current = __assign(__assign({}, allFormDataRef.current), values); // @ts-ignore\n\n        run(pagination, values, {\n          allFormData: allFormDataRef.current,\n          type: type\n        });\n      })[\"catch\"](function (err) {\n        return err;\n      });\n    });\n  };\n\n  var reset = function reset() {\n    if (form) {\n      form.resetFields();\n    }\n\n    _submit();\n  };\n\n  var submit = function submit(e) {\n    var _a;\n\n    (_a = e === null || e === void 0 ? void 0 : e.preventDefault) === null || _a === void 0 ? void 0 : _a.call(e);\n\n    _submit();\n  };\n\n  var onTableChange = function onTableChange(pagination, filters, sorter) {\n    var _a = __read(params || []),\n        oldPaginationParams = _a[0],\n        restParams = _a.slice(1);\n\n    run.apply(void 0, __spread([__assign(__assign({}, oldPaginationParams), {\n      current: pagination.current,\n      pageSize: pagination.pageSize,\n      filters: filters,\n      sorter: sorter\n    })], restParams));\n  }; // init\n\n\n  useEffect(function () {\n    // if has cache, use cached params. ignore manual and ready.\n    if (params.length > 0) {\n      allFormDataRef.current = (cacheFormTableData === null || cacheFormTableData === void 0 ? void 0 : cacheFormTableData.allFormData) || {};\n      restoreForm(); // @ts-ignore\n\n      run.apply(void 0, __spread(params));\n      return;\n    }\n\n    if (!manual && ready) {\n      allFormDataRef.current = (defaultParams === null || defaultParams === void 0 ? void 0 : defaultParams[1]) || {};\n      restoreForm();\n\n      _submit(defaultParams === null || defaultParams === void 0 ? void 0 : defaultParams[0]);\n    }\n  }, []); // change search type, restore form data\n\n  useUpdateEffect(function () {\n    if (!ready) {\n      return;\n    }\n\n    restoreForm();\n  }, [type]); // refresh & ready change on the same time\n\n  var hasAutoRun = useRef(false);\n  hasAutoRun.current = false;\n  useUpdateEffect(function () {\n    if (!manual && ready) {\n      hasAutoRun.current = true;\n\n      if (form) {\n        form.resetFields();\n      }\n\n      allFormDataRef.current = (defaultParams === null || defaultParams === void 0 ? void 0 : defaultParams[1]) || {};\n      restoreForm();\n\n      _submit(defaultParams === null || defaultParams === void 0 ? void 0 : defaultParams[0]);\n    }\n  }, [ready]);\n  useUpdateEffect(function () {\n    if (hasAutoRun.current) {\n      return;\n    }\n\n    if (!ready) {\n      return;\n    }\n\n    if (!manual) {\n      hasAutoRun.current = true;\n      result.pagination.changeCurrent(1);\n    }\n  }, __spread(refreshDeps));\n  return __assign(__assign({}, result), {\n    tableProps: {\n      dataSource: ((_a = result.data) === null || _a === void 0 ? void 0 : _a.list) || [],\n      loading: result.loading,\n      onChange: useMemoizedFn(onTableChange),\n      pagination: {\n        current: result.pagination.current,\n        pageSize: result.pagination.pageSize,\n        total: result.pagination.total\n      }\n    },\n    search: {\n      submit: useMemoizedFn(submit),\n      type: type,\n      changeType: useMemoizedFn(changeType),\n      reset: useMemoizedFn(reset)\n    }\n  });\n};\n\nexport default useAntdTable;"]},"metadata":{},"sourceType":"module"}