{"ast":null,"code":"import { mergeProps } from '../../utils/with-default-props';\nimport React, { useState, useRef } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { PictureOutline, PictureWrongOutline } from 'antd-mobile-icons';\nimport { staged } from 'staged-components';\nimport { toCSSLength } from '../../utils/to-css-length';\nimport { LazyDetector } from './lazy-detector';\nimport { useIsomorphicUpdateLayoutEffect } from '../../utils/use-isomorphic-update-layout-effect';\nconst classPrefix = `adm-image`;\nconst defaultProps = {\n  fit: 'fill',\n  placeholder: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(PictureOutline, null)),\n  fallback: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(PictureWrongOutline, null)),\n  lazy: false\n};\nexport const Image = staged(p => {\n  const props = mergeProps(defaultProps, p);\n  const [loaded, setLoaded] = useState(false);\n  const [failed, setFailed] = useState(false);\n  const ref = useRef(null);\n  let src = props.src;\n  let srcSet = props.srcSet;\n  const [initialized, setInitialized] = useState(!props.lazy);\n  src = initialized ? props.src : undefined;\n  srcSet = initialized ? props.srcSet : undefined;\n  useIsomorphicUpdateLayoutEffect(() => {\n    setLoaded(false);\n    setFailed(false);\n  }, [src]);\n\n  function renderInner() {\n    if (failed) {\n      return React.createElement(React.Fragment, null, props.fallback);\n    }\n\n    const img = React.createElement(\"img\", {\n      className: `${classPrefix}-img`,\n      src: src,\n      alt: props.alt,\n      onClick: props.onClick,\n      onLoad: e => {\n        var _a;\n\n        setLoaded(true);\n        (_a = props.onLoad) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      onError: e => {\n        var _a;\n\n        setFailed(true);\n        (_a = props.onError) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      style: {\n        objectFit: props.fit,\n        display: loaded ? 'block' : 'none'\n      },\n      crossOrigin: props.crossOrigin,\n      decoding: props.decoding,\n      loading: props.loading,\n      referrerPolicy: props.referrerPolicy,\n      sizes: props.sizes,\n      srcSet: srcSet,\n      useMap: props.useMap\n    });\n    return React.createElement(React.Fragment, null, !loaded && props.placeholder, img);\n  }\n\n  const style = {};\n\n  if (props.width) {\n    style['--width'] = toCSSLength(props.width);\n  }\n\n  if (props.height) {\n    style['--height'] = toCSSLength(props.height);\n  }\n\n  return withNativeProps(props, React.createElement(\"div\", {\n    ref: ref,\n    className: classPrefix,\n    style: style\n  }, props.lazy && !initialized && React.createElement(LazyDetector, {\n    onActive: () => {\n      setInitialized(true);\n    }\n  }), renderInner()));\n});","map":{"version":3,"sources":["D:/react/project0330/node_modules/antd-mobile/es/components/image/image.js"],"names":["mergeProps","React","useState","useRef","withNativeProps","PictureOutline","PictureWrongOutline","staged","toCSSLength","LazyDetector","useIsomorphicUpdateLayoutEffect","classPrefix","defaultProps","fit","placeholder","createElement","className","fallback","lazy","Image","p","props","loaded","setLoaded","failed","setFailed","ref","src","srcSet","initialized","setInitialized","undefined","renderInner","Fragment","img","alt","onClick","onLoad","e","_a","call","onError","style","objectFit","display","crossOrigin","decoding","loading","referrerPolicy","sizes","useMap","width","height","onActive"],"mappings":"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","sourcesContent":["import { mergeProps } from '../../utils/with-default-props';\nimport React, { useState, useRef } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { PictureOutline, PictureWrongOutline } from 'antd-mobile-icons';\nimport { staged } from 'staged-components';\nimport { toCSSLength } from '../../utils/to-css-length';\nimport { LazyDetector } from './lazy-detector';\nimport { useIsomorphicUpdateLayoutEffect } from '../../utils/use-isomorphic-update-layout-effect';\nconst classPrefix = `adm-image`;\nconst defaultProps = {\n  fit: 'fill',\n  placeholder: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(PictureOutline, null)),\n  fallback: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(PictureWrongOutline, null)),\n  lazy: false\n};\nexport const Image = staged(p => {\n  const props = mergeProps(defaultProps, p);\n  const [loaded, setLoaded] = useState(false);\n  const [failed, setFailed] = useState(false);\n  const ref = useRef(null);\n  let src = props.src;\n  let srcSet = props.srcSet;\n  const [initialized, setInitialized] = useState(!props.lazy);\n  src = initialized ? props.src : undefined;\n  srcSet = initialized ? props.srcSet : undefined;\n  useIsomorphicUpdateLayoutEffect(() => {\n    setLoaded(false);\n    setFailed(false);\n  }, [src]);\n\n  function renderInner() {\n    if (failed) {\n      return React.createElement(React.Fragment, null, props.fallback);\n    }\n\n    const img = React.createElement(\"img\", {\n      className: `${classPrefix}-img`,\n      src: src,\n      alt: props.alt,\n      onClick: props.onClick,\n      onLoad: e => {\n        var _a;\n\n        setLoaded(true);\n        (_a = props.onLoad) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      onError: e => {\n        var _a;\n\n        setFailed(true);\n        (_a = props.onError) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      style: {\n        objectFit: props.fit,\n        display: loaded ? 'block' : 'none'\n      },\n      crossOrigin: props.crossOrigin,\n      decoding: props.decoding,\n      loading: props.loading,\n      referrerPolicy: props.referrerPolicy,\n      sizes: props.sizes,\n      srcSet: srcSet,\n      useMap: props.useMap\n    });\n    return React.createElement(React.Fragment, null, !loaded && props.placeholder, img);\n  }\n\n  const style = {};\n\n  if (props.width) {\n    style['--width'] = toCSSLength(props.width);\n  }\n\n  if (props.height) {\n    style['--height'] = toCSSLength(props.height);\n  }\n\n  return withNativeProps(props, React.createElement(\"div\", {\n    ref: ref,\n    className: classPrefix,\n    style: style\n  }, props.lazy && !initialized && React.createElement(LazyDetector, {\n    onActive: () => {\n      setInitialized(true);\n    }\n  }), renderInner()));\n});"]},"metadata":{},"sourceType":"module"}