{"ast":null,"code":"import React, { forwardRef, useState, useImperativeHandle } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport dayjs from 'dayjs';\nimport classNames from 'classnames';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { ArrowLeft } from './arrow-left';\nimport { ArrowLeftDouble } from './arrow-left-double';\nimport { useConfig } from '../config-provider';\nimport isoWeek from 'dayjs/plugin/isoWeek';\nimport { useUpdateEffect } from 'ahooks';\nimport { usePropsValue } from '../../utils/use-props-value';\nimport { convertValueToRange } from './convert';\ndayjs.extend(isoWeek);\nconst classPrefix = 'adm-calendar';\nconst defaultProps = {\n  weekStartsOn: 'Sunday',\n  defaultValue: null,\n  allowClear: true\n};\nexport const Calendar = forwardRef((p, ref) => {\n  const today = dayjs();\n  const props = mergeProps(defaultProps, p);\n  const {\n    locale\n  } = useConfig();\n  const markItems = [...locale.Calendar.markItems];\n\n  if (props.weekStartsOn === 'Sunday') {\n    const item = markItems.pop();\n    if (item) markItems.unshift(item);\n  }\n\n  const [dateRange, setDateRange] = usePropsValue({\n    value: props.value === undefined ? undefined : convertValueToRange(props.selectionMode, props.value),\n    defaultValue: convertValueToRange(props.selectionMode, props.defaultValue),\n    onChange: v => {\n      var _a, _b;\n\n      if (props.selectionMode === 'single') {\n        (_a = props.onChange) === null || _a === void 0 ? void 0 : _a.call(props, v ? v[0] : null);\n      } else if (props.selectionMode === 'range') {\n        (_b = props.onChange) === null || _b === void 0 ? void 0 : _b.call(props, v);\n      }\n    }\n  });\n  const [intermediate, setIntermediate] = useState(false);\n  const [current, setCurrent] = useState(() => dayjs(dateRange ? dateRange[0] : today).date(1));\n  useUpdateEffect(() => {\n    var _a;\n\n    (_a = props.onPageChange) === null || _a === void 0 ? void 0 : _a.call(props, current.year(), current.month() + 1);\n  }, [current]);\n  useImperativeHandle(ref, () => ({\n    jumpTo: pageOrPageGenerator => {\n      let page;\n\n      if (typeof pageOrPageGenerator === 'function') {\n        page = pageOrPageGenerator({\n          year: current.year(),\n          month: current.month() + 1\n        });\n      } else {\n        page = pageOrPageGenerator;\n      }\n\n      setCurrent(dayjs().year(page.year).month(page.month - 1));\n    },\n    jumpToToday: () => {\n      setCurrent(dayjs().date(1));\n    }\n  }));\n  const header = React.createElement(\"div\", {\n    className: `${classPrefix}-header`\n  }, React.createElement(\"a\", {\n    className: `${classPrefix}-arrow-button`,\n    onClick: () => {\n      setCurrent(current.subtract(1, 'year'));\n    }\n  }, React.createElement(ArrowLeftDouble, null)), React.createElement(\"a\", {\n    className: `${classPrefix}-arrow-button`,\n    onClick: () => {\n      setCurrent(current.subtract(1, 'month'));\n    }\n  }, React.createElement(ArrowLeft, null)), React.createElement(\"div\", {\n    className: `${classPrefix}-title`\n  }, locale.Calendar.renderYearAndMonth(current.year(), current.month() + 1)), React.createElement(\"a\", {\n    className: `${classPrefix}-arrow-button ${classPrefix}-arrow-button-right`,\n    onClick: () => {\n      setCurrent(current.add(1, 'month'));\n    }\n  }, React.createElement(ArrowLeft, null)), React.createElement(\"a\", {\n    className: `${classPrefix}-arrow-button ${classPrefix}-arrow-button-right`,\n    onClick: () => {\n      setCurrent(current.add(1, 'year'));\n    }\n  }, React.createElement(ArrowLeftDouble, null)));\n\n  function renderCells() {\n    var _a;\n\n    const cells = [];\n    let iterator = current.subtract(current.isoWeekday(), 'day');\n\n    if (props.weekStartsOn === 'Monday') {\n      iterator = iterator.add(1, 'day');\n    }\n\n    while (cells.length < 6 * 7) {\n      const d = iterator;\n      let isSelect = false;\n      let isBegin = false;\n      let isEnd = false;\n\n      if (dateRange) {\n        const [begin, end] = dateRange;\n        isBegin = d.isSame(begin, 'day');\n        isEnd = d.isSame(end, 'day');\n        isSelect = isBegin || isEnd || d.isAfter(begin, 'day') && d.isBefore(end, 'day');\n      }\n\n      const inThisMonth = d.month() === current.month();\n      cells.push(React.createElement(\"div\", {\n        key: d.valueOf(),\n        className: classNames(`${classPrefix}-cell`, inThisMonth ? `${classPrefix}-cell-in` : `${classPrefix}-cell-out`, inThisMonth && {\n          [`${classPrefix}-cell-today`]: d.isSame(today, 'day'),\n          [`${classPrefix}-cell-selected`]: isSelect,\n          [`${classPrefix}-cell-selected-begin`]: isBegin,\n          [`${classPrefix}-cell-selected-end`]: isEnd\n        }),\n        onClick: () => {\n          if (!props.selectionMode) return;\n          const date = d.toDate();\n\n          if (!inThisMonth) {\n            setCurrent(d.clone().date(1));\n          }\n\n          function shouldClear() {\n            if (!props.allowClear) return false;\n            if (!dateRange) return false;\n            const [begin, end] = dateRange;\n            return d.isSame(begin, 'date') && d.isSame(end, 'day');\n          }\n\n          if (props.selectionMode === 'single') {\n            if (props.allowClear && shouldClear()) {\n              setDateRange(null);\n              return;\n            }\n\n            setDateRange([date, date]);\n          } else if (props.selectionMode === 'range') {\n            if (!dateRange) {\n              setDateRange([date, date]);\n              setIntermediate(true);\n              return;\n            }\n\n            if (shouldClear()) {\n              setDateRange(null);\n              setIntermediate(false);\n              return;\n            }\n\n            if (intermediate) {\n              const another = dateRange[0];\n              setDateRange(another > date ? [date, another] : [another, date]);\n              setIntermediate(false);\n            } else {\n              setDateRange([date, date]);\n              setIntermediate(true);\n            }\n          }\n        }\n      }, React.createElement(\"div\", {\n        className: `${classPrefix}-cell-top`\n      }, d.date()), React.createElement(\"div\", {\n        className: `${classPrefix}-cell-bottom`\n      }, (_a = props.renderLabel) === null || _a === void 0 ? void 0 : _a.call(props, d.toDate()))));\n      iterator = iterator.add(1, 'day');\n    }\n\n    return cells;\n  }\n\n  const body = React.createElement(\"div\", {\n    className: `${classPrefix}-cells`\n  }, renderCells());\n  const mark = React.createElement(\"div\", {\n    className: `${classPrefix}-mark`\n  }, markItems.map(item => React.createElement(\"div\", {\n    key: item,\n    className: `${classPrefix}-mark-cell`\n  }, item)));\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix\n  }, header, mark, body));\n});","map":{"version":3,"sources":["D:/react/project0330/node_modules/antd-mobile/es/components/calendar/calendar.js"],"names":["React","forwardRef","useState","useImperativeHandle","withNativeProps","dayjs","classNames","mergeProps","ArrowLeft","ArrowLeftDouble","useConfig","isoWeek","useUpdateEffect","usePropsValue","convertValueToRange","extend","classPrefix","defaultProps","weekStartsOn","defaultValue","allowClear","Calendar","p","ref","today","props","locale","markItems","item","pop","unshift","dateRange","setDateRange","value","undefined","selectionMode","onChange","v","_a","_b","call","intermediate","setIntermediate","current","setCurrent","date","onPageChange","year","month","jumpTo","pageOrPageGenerator","page","jumpToToday","header","createElement","className","onClick","subtract","renderYearAndMonth","add","renderCells","cells","iterator","isoWeekday","length","d","isSelect","isBegin","isEnd","begin","end","isSame","isAfter","isBefore","inThisMonth","push","key","valueOf","toDate","clone","shouldClear","another","renderLabel","body","mark","map"],"mappings":"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","sourcesContent":["import React, { forwardRef, useState, useImperativeHandle } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport dayjs from 'dayjs';\nimport classNames from 'classnames';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { ArrowLeft } from './arrow-left';\nimport { ArrowLeftDouble } from './arrow-left-double';\nimport { useConfig } from '../config-provider';\nimport isoWeek from 'dayjs/plugin/isoWeek';\nimport { useUpdateEffect } from 'ahooks';\nimport { usePropsValue } from '../../utils/use-props-value';\nimport { convertValueToRange } from './convert';\ndayjs.extend(isoWeek);\nconst classPrefix = 'adm-calendar';\nconst defaultProps = {\n  weekStartsOn: 'Sunday',\n  defaultValue: null,\n  allowClear: true\n};\nexport const Calendar = forwardRef((p, ref) => {\n  const today = dayjs();\n  const props = mergeProps(defaultProps, p);\n  const {\n    locale\n  } = useConfig();\n  const markItems = [...locale.Calendar.markItems];\n\n  if (props.weekStartsOn === 'Sunday') {\n    const item = markItems.pop();\n    if (item) markItems.unshift(item);\n  }\n\n  const [dateRange, setDateRange] = usePropsValue({\n    value: props.value === undefined ? undefined : convertValueToRange(props.selectionMode, props.value),\n    defaultValue: convertValueToRange(props.selectionMode, props.defaultValue),\n    onChange: v => {\n      var _a, _b;\n\n      if (props.selectionMode === 'single') {\n        (_a = props.onChange) === null || _a === void 0 ? void 0 : _a.call(props, v ? v[0] : null);\n      } else if (props.selectionMode === 'range') {\n        (_b = props.onChange) === null || _b === void 0 ? void 0 : _b.call(props, v);\n      }\n    }\n  });\n  const [intermediate, setIntermediate] = useState(false);\n  const [current, setCurrent] = useState(() => dayjs(dateRange ? dateRange[0] : today).date(1));\n  useUpdateEffect(() => {\n    var _a;\n\n    (_a = props.onPageChange) === null || _a === void 0 ? void 0 : _a.call(props, current.year(), current.month() + 1);\n  }, [current]);\n  useImperativeHandle(ref, () => ({\n    jumpTo: pageOrPageGenerator => {\n      let page;\n\n      if (typeof pageOrPageGenerator === 'function') {\n        page = pageOrPageGenerator({\n          year: current.year(),\n          month: current.month() + 1\n        });\n      } else {\n        page = pageOrPageGenerator;\n      }\n\n      setCurrent(dayjs().year(page.year).month(page.month - 1));\n    },\n    jumpToToday: () => {\n      setCurrent(dayjs().date(1));\n    }\n  }));\n  const header = React.createElement(\"div\", {\n    className: `${classPrefix}-header`\n  }, React.createElement(\"a\", {\n    className: `${classPrefix}-arrow-button`,\n    onClick: () => {\n      setCurrent(current.subtract(1, 'year'));\n    }\n  }, React.createElement(ArrowLeftDouble, null)), React.createElement(\"a\", {\n    className: `${classPrefix}-arrow-button`,\n    onClick: () => {\n      setCurrent(current.subtract(1, 'month'));\n    }\n  }, React.createElement(ArrowLeft, null)), React.createElement(\"div\", {\n    className: `${classPrefix}-title`\n  }, locale.Calendar.renderYearAndMonth(current.year(), current.month() + 1)), React.createElement(\"a\", {\n    className: `${classPrefix}-arrow-button ${classPrefix}-arrow-button-right`,\n    onClick: () => {\n      setCurrent(current.add(1, 'month'));\n    }\n  }, React.createElement(ArrowLeft, null)), React.createElement(\"a\", {\n    className: `${classPrefix}-arrow-button ${classPrefix}-arrow-button-right`,\n    onClick: () => {\n      setCurrent(current.add(1, 'year'));\n    }\n  }, React.createElement(ArrowLeftDouble, null)));\n\n  function renderCells() {\n    var _a;\n\n    const cells = [];\n    let iterator = current.subtract(current.isoWeekday(), 'day');\n\n    if (props.weekStartsOn === 'Monday') {\n      iterator = iterator.add(1, 'day');\n    }\n\n    while (cells.length < 6 * 7) {\n      const d = iterator;\n      let isSelect = false;\n      let isBegin = false;\n      let isEnd = false;\n\n      if (dateRange) {\n        const [begin, end] = dateRange;\n        isBegin = d.isSame(begin, 'day');\n        isEnd = d.isSame(end, 'day');\n        isSelect = isBegin || isEnd || d.isAfter(begin, 'day') && d.isBefore(end, 'day');\n      }\n\n      const inThisMonth = d.month() === current.month();\n      cells.push(React.createElement(\"div\", {\n        key: d.valueOf(),\n        className: classNames(`${classPrefix}-cell`, inThisMonth ? `${classPrefix}-cell-in` : `${classPrefix}-cell-out`, inThisMonth && {\n          [`${classPrefix}-cell-today`]: d.isSame(today, 'day'),\n          [`${classPrefix}-cell-selected`]: isSelect,\n          [`${classPrefix}-cell-selected-begin`]: isBegin,\n          [`${classPrefix}-cell-selected-end`]: isEnd\n        }),\n        onClick: () => {\n          if (!props.selectionMode) return;\n          const date = d.toDate();\n\n          if (!inThisMonth) {\n            setCurrent(d.clone().date(1));\n          }\n\n          function shouldClear() {\n            if (!props.allowClear) return false;\n            if (!dateRange) return false;\n            const [begin, end] = dateRange;\n            return d.isSame(begin, 'date') && d.isSame(end, 'day');\n          }\n\n          if (props.selectionMode === 'single') {\n            if (props.allowClear && shouldClear()) {\n              setDateRange(null);\n              return;\n            }\n\n            setDateRange([date, date]);\n          } else if (props.selectionMode === 'range') {\n            if (!dateRange) {\n              setDateRange([date, date]);\n              setIntermediate(true);\n              return;\n            }\n\n            if (shouldClear()) {\n              setDateRange(null);\n              setIntermediate(false);\n              return;\n            }\n\n            if (intermediate) {\n              const another = dateRange[0];\n              setDateRange(another > date ? [date, another] : [another, date]);\n              setIntermediate(false);\n            } else {\n              setDateRange([date, date]);\n              setIntermediate(true);\n            }\n          }\n        }\n      }, React.createElement(\"div\", {\n        className: `${classPrefix}-cell-top`\n      }, d.date()), React.createElement(\"div\", {\n        className: `${classPrefix}-cell-bottom`\n      }, (_a = props.renderLabel) === null || _a === void 0 ? void 0 : _a.call(props, d.toDate()))));\n      iterator = iterator.add(1, 'day');\n    }\n\n    return cells;\n  }\n\n  const body = React.createElement(\"div\", {\n    className: `${classPrefix}-cells`\n  }, renderCells());\n  const mark = React.createElement(\"div\", {\n    className: `${classPrefix}-mark`\n  }, markItems.map(item => React.createElement(\"div\", {\n    key: item,\n    className: `${classPrefix}-mark-cell`\n  }, item)));\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix\n  }, header, mark, body));\n});"]},"metadata":{},"sourceType":"module"}