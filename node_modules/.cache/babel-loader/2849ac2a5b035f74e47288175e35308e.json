{"ast":null,"code":"import React, { useRef } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport List from '../list';\nimport { DownOutline } from 'antd-mobile-icons';\nimport classNames from 'classnames';\nimport { useSpring, animated } from '@react-spring/web';\nimport { usePropsValue } from '../../utils/use-props-value';\nimport { useMount } from 'ahooks';\nimport { useShouldRender } from '../../utils/should-render';\nimport { useIsomorphicUpdateLayoutEffect } from '../../utils/use-isomorphic-update-layout-effect';\nconst classPrefix = `adm-collapse`;\nexport const CollapsePanel = () => {\n  return null;\n};\n\nconst CollapsePanelContent = props => {\n  const {\n    visible\n  } = props;\n  const innerRef = useRef(null);\n  const shouldRender = useShouldRender(visible, props.forceRender, props.destroyOnClose);\n  const [{\n    height\n  }, api] = useSpring(() => ({\n    from: {\n      height: 0\n    },\n    config: {\n      precision: 0.01,\n      mass: 1,\n      tension: 200,\n      friction: 25,\n      clamp: true\n    }\n  }));\n  useMount(() => {\n    if (!visible) return;\n    const inner = innerRef.current;\n    if (!inner) return;\n    api.start({\n      height: inner.offsetHeight,\n      immediate: true\n    });\n  });\n  useIsomorphicUpdateLayoutEffect(() => {\n    const inner = innerRef.current;\n    if (!inner) return;\n\n    if (visible) {\n      api.start({\n        height: inner.offsetHeight\n      });\n    } else {\n      api.start({\n        height: inner.offsetHeight,\n        immediate: true\n      });\n      api.start({\n        height: 0\n      });\n    }\n  }, [visible]);\n  return React.createElement(animated.div, {\n    className: `${classPrefix}-panel-content`,\n    style: {\n      height: height.to(v => {\n        if (height.idle && visible) {\n          return 'auto';\n        } else {\n          return v;\n        }\n      })\n    }\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-panel-content-inner`,\n    ref: innerRef\n  }, React.createElement(List.Item, null, shouldRender && props.children)));\n};\n\nexport const Collapse = props => {\n  var _a;\n\n  const panels = [];\n  React.Children.forEach(props.children, child => {\n    if (!React.isValidElement(child)) return;\n    const key = child.key;\n    if (typeof key !== 'string') return;\n    panels.push(child);\n  });\n  const [activeKey, setActiveKey] = usePropsValue(props.accordion ? {\n    value: props.activeKey === undefined ? undefined : props.activeKey === null ? [] : [props.activeKey],\n    defaultValue: props.defaultActiveKey === undefined || props.defaultActiveKey === null ? [] : [props.defaultActiveKey],\n    onChange: v => {\n      var _a, _b;\n\n      (_a = props.onChange) === null || _a === void 0 ? void 0 : _a.call(props, (_b = v[0]) !== null && _b !== void 0 ? _b : null);\n    }\n  } : {\n    value: props.activeKey,\n    defaultValue: (_a = props.defaultActiveKey) !== null && _a !== void 0 ? _a : [],\n    onChange: props.onChange\n  });\n  const activeKeyList = activeKey === null ? [] : Array.isArray(activeKey) ? activeKey : [activeKey];\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix\n  }, React.createElement(List, null, panels.map(panel => {\n    const key = panel.key;\n    const active = activeKeyList.includes(key);\n\n    function handleClick(event) {\n      var _a, _b;\n\n      if (props.accordion) {\n        if (active) {\n          setActiveKey([]);\n        } else {\n          setActiveKey([key]);\n        }\n      } else {\n        if (active) {\n          setActiveKey(activeKeyList.filter(v => v !== key));\n        } else {\n          setActiveKey([...activeKeyList, key]);\n        }\n      }\n\n      (_b = (_a = panel.props).onClick) === null || _b === void 0 ? void 0 : _b.call(_a, event);\n    }\n\n    const renderArrow = () => {\n      let arrow = React.createElement(DownOutline, null);\n\n      if (props.arrow !== undefined) {\n        arrow = props.arrow;\n      }\n\n      if (panel.props.arrow !== undefined) {\n        arrow = panel.props.arrow;\n      }\n\n      return typeof arrow === 'function' ? arrow(active) : React.createElement(\"div\", {\n        className: classNames(`${classPrefix}-arrow`, {\n          [`${classPrefix}-arrow-active`]: active\n        })\n      }, arrow);\n    };\n\n    return React.createElement(React.Fragment, {\n      key: key\n    }, withNativeProps(panel.props, React.createElement(List.Item, {\n      className: `${classPrefix}-panel-header`,\n      onClick: handleClick,\n      disabled: panel.props.disabled,\n      arrow: renderArrow()\n    }, panel.props.title)), React.createElement(CollapsePanelContent, {\n      visible: active,\n      forceRender: !!panel.props.forceRender,\n      destroyOnClose: !!panel.props.destroyOnClose\n    }, panel.props.children));\n  }))));\n};","map":{"version":3,"sources":["D:/react/project0330/node_modules/antd-mobile/es/components/collapse/collapse.js"],"names":["React","useRef","withNativeProps","List","DownOutline","classNames","useSpring","animated","usePropsValue","useMount","useShouldRender","useIsomorphicUpdateLayoutEffect","classPrefix","CollapsePanel","CollapsePanelContent","props","visible","innerRef","shouldRender","forceRender","destroyOnClose","height","api","from","config","precision","mass","tension","friction","clamp","inner","current","start","offsetHeight","immediate","createElement","div","className","style","to","v","idle","ref","Item","children","Collapse","_a","panels","Children","forEach","child","isValidElement","key","push","activeKey","setActiveKey","accordion","value","undefined","defaultValue","defaultActiveKey","onChange","_b","call","activeKeyList","Array","isArray","map","panel","active","includes","handleClick","event","filter","onClick","renderArrow","arrow","Fragment","disabled","title"],"mappings":"AAAA,OAAOA,KAAP,IAAgBC,MAAhB,QAA8B,OAA9B;AACA,SAASC,eAAT,QAAgC,0BAAhC;AACA,OAAOC,IAAP,MAAiB,SAAjB;AACA,SAASC,WAAT,QAA4B,mBAA5B;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,SAASC,SAAT,EAAoBC,QAApB,QAAoC,mBAApC;AACA,SAASC,aAAT,QAA8B,6BAA9B;AACA,SAASC,QAAT,QAAyB,QAAzB;AACA,SAASC,eAAT,QAAgC,2BAAhC;AACA,SAASC,+BAAT,QAAgD,iDAAhD;AACA,MAAMC,WAAW,GAAI,cAArB;AACA,OAAO,MAAMC,aAAa,GAAG,MAAM;AACjC,SAAO,IAAP;AACD,CAFM;;AAIP,MAAMC,oBAAoB,GAAGC,KAAK,IAAI;AACpC,QAAM;AACJC,IAAAA;AADI,MAEFD,KAFJ;AAGA,QAAME,QAAQ,GAAGhB,MAAM,CAAC,IAAD,CAAvB;AACA,QAAMiB,YAAY,GAAGR,eAAe,CAACM,OAAD,EAAUD,KAAK,CAACI,WAAhB,EAA6BJ,KAAK,CAACK,cAAnC,CAApC;AACA,QAAM,CAAC;AACLC,IAAAA;AADK,GAAD,EAEHC,GAFG,IAEIhB,SAAS,CAAC,OAAO;AACzBiB,IAAAA,IAAI,EAAE;AACJF,MAAAA,MAAM,EAAE;AADJ,KADmB;AAIzBG,IAAAA,MAAM,EAAE;AACNC,MAAAA,SAAS,EAAE,IADL;AAENC,MAAAA,IAAI,EAAE,CAFA;AAGNC,MAAAA,OAAO,EAAE,GAHH;AAINC,MAAAA,QAAQ,EAAE,EAJJ;AAKNC,MAAAA,KAAK,EAAE;AALD;AAJiB,GAAP,CAAD,CAFnB;AAcApB,EAAAA,QAAQ,CAAC,MAAM;AACb,QAAI,CAACO,OAAL,EAAc;AACd,UAAMc,KAAK,GAAGb,QAAQ,CAACc,OAAvB;AACA,QAAI,CAACD,KAAL,EAAY;AACZR,IAAAA,GAAG,CAACU,KAAJ,CAAU;AACRX,MAAAA,MAAM,EAAES,KAAK,CAACG,YADN;AAERC,MAAAA,SAAS,EAAE;AAFH,KAAV;AAID,GARO,CAAR;AASAvB,EAAAA,+BAA+B,CAAC,MAAM;AACpC,UAAMmB,KAAK,GAAGb,QAAQ,CAACc,OAAvB;AACA,QAAI,CAACD,KAAL,EAAY;;AAEZ,QAAId,OAAJ,EAAa;AACXM,MAAAA,GAAG,CAACU,KAAJ,CAAU;AACRX,QAAAA,MAAM,EAAES,KAAK,CAACG;AADN,OAAV;AAGD,KAJD,MAIO;AACLX,MAAAA,GAAG,CAACU,KAAJ,CAAU;AACRX,QAAAA,MAAM,EAAES,KAAK,CAACG,YADN;AAERC,QAAAA,SAAS,EAAE;AAFH,OAAV;AAIAZ,MAAAA,GAAG,CAACU,KAAJ,CAAU;AACRX,QAAAA,MAAM,EAAE;AADA,OAAV;AAGD;AACF,GAjB8B,EAiB5B,CAACL,OAAD,CAjB4B,CAA/B;AAkBA,SAAOhB,KAAK,CAACmC,aAAN,CAAoB5B,QAAQ,CAAC6B,GAA7B,EAAkC;AACvCC,IAAAA,SAAS,EAAG,GAAEzB,WAAY,gBADa;AAEvC0B,IAAAA,KAAK,EAAE;AACLjB,MAAAA,MAAM,EAAEA,MAAM,CAACkB,EAAP,CAAUC,CAAC,IAAI;AACrB,YAAInB,MAAM,CAACoB,IAAP,IAAezB,OAAnB,EAA4B;AAC1B,iBAAO,MAAP;AACD,SAFD,MAEO;AACL,iBAAOwB,CAAP;AACD;AACF,OANO;AADH;AAFgC,GAAlC,EAWJxC,KAAK,CAACmC,aAAN,CAAoB,KAApB,EAA2B;AAC5BE,IAAAA,SAAS,EAAG,GAAEzB,WAAY,sBADE;AAE5B8B,IAAAA,GAAG,EAAEzB;AAFuB,GAA3B,EAGAjB,KAAK,CAACmC,aAAN,CAAoBhC,IAAI,CAACwC,IAAzB,EAA+B,IAA/B,EAAqCzB,YAAY,IAAIH,KAAK,CAAC6B,QAA3D,CAHA,CAXI,CAAP;AAeD,CA9DD;;AAgEA,OAAO,MAAMC,QAAQ,GAAG9B,KAAK,IAAI;AAC/B,MAAI+B,EAAJ;;AAEA,QAAMC,MAAM,GAAG,EAAf;AACA/C,EAAAA,KAAK,CAACgD,QAAN,CAAeC,OAAf,CAAuBlC,KAAK,CAAC6B,QAA7B,EAAuCM,KAAK,IAAI;AAC9C,QAAI,CAAClD,KAAK,CAACmD,cAAN,CAAqBD,KAArB,CAAL,EAAkC;AAClC,UAAME,GAAG,GAAGF,KAAK,CAACE,GAAlB;AACA,QAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AAC7BL,IAAAA,MAAM,CAACM,IAAP,CAAYH,KAAZ;AACD,GALD;AAMA,QAAM,CAACI,SAAD,EAAYC,YAAZ,IAA4B/C,aAAa,CAACO,KAAK,CAACyC,SAAN,GAAkB;AAChEC,IAAAA,KAAK,EAAE1C,KAAK,CAACuC,SAAN,KAAoBI,SAApB,GAAgCA,SAAhC,GAA4C3C,KAAK,CAACuC,SAAN,KAAoB,IAApB,GAA2B,EAA3B,GAAgC,CAACvC,KAAK,CAACuC,SAAP,CADnB;AAEhEK,IAAAA,YAAY,EAAE5C,KAAK,CAAC6C,gBAAN,KAA2BF,SAA3B,IAAwC3C,KAAK,CAAC6C,gBAAN,KAA2B,IAAnE,GAA0E,EAA1E,GAA+E,CAAC7C,KAAK,CAAC6C,gBAAP,CAF7B;AAGhEC,IAAAA,QAAQ,EAAErB,CAAC,IAAI;AACb,UAAIM,EAAJ,EAAQgB,EAAR;;AAEA,OAAChB,EAAE,GAAG/B,KAAK,CAAC8C,QAAZ,MAA0B,IAA1B,IAAkCf,EAAE,KAAK,KAAK,CAA9C,GAAkD,KAAK,CAAvD,GAA2DA,EAAE,CAACiB,IAAH,CAAQhD,KAAR,EAAe,CAAC+C,EAAE,GAAGtB,CAAC,CAAC,CAAD,CAAP,MAAgB,IAAhB,IAAwBsB,EAAE,KAAK,KAAK,CAApC,GAAwCA,EAAxC,GAA6C,IAA5D,CAA3D;AACD;AAP+D,GAAlB,GAQ5C;AACFL,IAAAA,KAAK,EAAE1C,KAAK,CAACuC,SADX;AAEFK,IAAAA,YAAY,EAAE,CAACb,EAAE,GAAG/B,KAAK,CAAC6C,gBAAZ,MAAkC,IAAlC,IAA0Cd,EAAE,KAAK,KAAK,CAAtD,GAA0DA,EAA1D,GAA+D,EAF3E;AAGFe,IAAAA,QAAQ,EAAE9C,KAAK,CAAC8C;AAHd,GAR2C,CAA/C;AAaA,QAAMG,aAAa,GAAGV,SAAS,KAAK,IAAd,GAAqB,EAArB,GAA0BW,KAAK,CAACC,OAAN,CAAcZ,SAAd,IAA2BA,SAA3B,GAAuC,CAACA,SAAD,CAAvF;AACA,SAAOpD,eAAe,CAACa,KAAD,EAAQf,KAAK,CAACmC,aAAN,CAAoB,KAApB,EAA2B;AACvDE,IAAAA,SAAS,EAAEzB;AAD4C,GAA3B,EAE3BZ,KAAK,CAACmC,aAAN,CAAoBhC,IAApB,EAA0B,IAA1B,EAAgC4C,MAAM,CAACoB,GAAP,CAAWC,KAAK,IAAI;AACrD,UAAMhB,GAAG,GAAGgB,KAAK,CAAChB,GAAlB;AACA,UAAMiB,MAAM,GAAGL,aAAa,CAACM,QAAd,CAAuBlB,GAAvB,CAAf;;AAEA,aAASmB,WAAT,CAAqBC,KAArB,EAA4B;AAC1B,UAAI1B,EAAJ,EAAQgB,EAAR;;AAEA,UAAI/C,KAAK,CAACyC,SAAV,EAAqB;AACnB,YAAIa,MAAJ,EAAY;AACVd,UAAAA,YAAY,CAAC,EAAD,CAAZ;AACD,SAFD,MAEO;AACLA,UAAAA,YAAY,CAAC,CAACH,GAAD,CAAD,CAAZ;AACD;AACF,OAND,MAMO;AACL,YAAIiB,MAAJ,EAAY;AACVd,UAAAA,YAAY,CAACS,aAAa,CAACS,MAAd,CAAqBjC,CAAC,IAAIA,CAAC,KAAKY,GAAhC,CAAD,CAAZ;AACD,SAFD,MAEO;AACLG,UAAAA,YAAY,CAAC,CAAC,GAAGS,aAAJ,EAAmBZ,GAAnB,CAAD,CAAZ;AACD;AACF;;AAED,OAACU,EAAE,GAAG,CAAChB,EAAE,GAAGsB,KAAK,CAACrD,KAAZ,EAAmB2D,OAAzB,MAAsC,IAAtC,IAA8CZ,EAAE,KAAK,KAAK,CAA1D,GAA8D,KAAK,CAAnE,GAAuEA,EAAE,CAACC,IAAH,CAAQjB,EAAR,EAAY0B,KAAZ,CAAvE;AACD;;AAED,UAAMG,WAAW,GAAG,MAAM;AACxB,UAAIC,KAAK,GAAG5E,KAAK,CAACmC,aAAN,CAAoB/B,WAApB,EAAiC,IAAjC,CAAZ;;AAEA,UAAIW,KAAK,CAAC6D,KAAN,KAAgBlB,SAApB,EAA+B;AAC7BkB,QAAAA,KAAK,GAAG7D,KAAK,CAAC6D,KAAd;AACD;;AAED,UAAIR,KAAK,CAACrD,KAAN,CAAY6D,KAAZ,KAAsBlB,SAA1B,EAAqC;AACnCkB,QAAAA,KAAK,GAAGR,KAAK,CAACrD,KAAN,CAAY6D,KAApB;AACD;;AAED,aAAO,OAAOA,KAAP,KAAiB,UAAjB,GAA8BA,KAAK,CAACP,MAAD,CAAnC,GAA8CrE,KAAK,CAACmC,aAAN,CAAoB,KAApB,EAA2B;AAC9EE,QAAAA,SAAS,EAAEhC,UAAU,CAAE,GAAEO,WAAY,QAAhB,EAAyB;AAC5C,WAAE,GAAEA,WAAY,eAAhB,GAAiCyD;AADW,SAAzB;AADyD,OAA3B,EAIlDO,KAJkD,CAArD;AAKD,KAhBD;;AAkBA,WAAO5E,KAAK,CAACmC,aAAN,CAAoBnC,KAAK,CAAC6E,QAA1B,EAAoC;AACzCzB,MAAAA,GAAG,EAAEA;AADoC,KAApC,EAEJlD,eAAe,CAACkE,KAAK,CAACrD,KAAP,EAAcf,KAAK,CAACmC,aAAN,CAAoBhC,IAAI,CAACwC,IAAzB,EAA+B;AAC7DN,MAAAA,SAAS,EAAG,GAAEzB,WAAY,eADmC;AAE7D8D,MAAAA,OAAO,EAAEH,WAFoD;AAG7DO,MAAAA,QAAQ,EAAEV,KAAK,CAACrD,KAAN,CAAY+D,QAHuC;AAI7DF,MAAAA,KAAK,EAAED,WAAW;AAJ2C,KAA/B,EAK7BP,KAAK,CAACrD,KAAN,CAAYgE,KALiB,CAAd,CAFX,EAOiB/E,KAAK,CAACmC,aAAN,CAAoBrB,oBAApB,EAA0C;AAChEE,MAAAA,OAAO,EAAEqD,MADuD;AAEhElD,MAAAA,WAAW,EAAE,CAAC,CAACiD,KAAK,CAACrD,KAAN,CAAYI,WAFqC;AAGhEC,MAAAA,cAAc,EAAE,CAAC,CAACgD,KAAK,CAACrD,KAAN,CAAYK;AAHkC,KAA1C,EAIrBgD,KAAK,CAACrD,KAAN,CAAY6B,QAJS,CAPjB,CAAP;AAYD,GAtDkC,CAAhC,CAF2B,CAAR,CAAtB;AAyDD,CAjFM","sourcesContent":["import React, { useRef } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport List from '../list';\nimport { DownOutline } from 'antd-mobile-icons';\nimport classNames from 'classnames';\nimport { useSpring, animated } from '@react-spring/web';\nimport { usePropsValue } from '../../utils/use-props-value';\nimport { useMount } from 'ahooks';\nimport { useShouldRender } from '../../utils/should-render';\nimport { useIsomorphicUpdateLayoutEffect } from '../../utils/use-isomorphic-update-layout-effect';\nconst classPrefix = `adm-collapse`;\nexport const CollapsePanel = () => {\n  return null;\n};\n\nconst CollapsePanelContent = props => {\n  const {\n    visible\n  } = props;\n  const innerRef = useRef(null);\n  const shouldRender = useShouldRender(visible, props.forceRender, props.destroyOnClose);\n  const [{\n    height\n  }, api] = useSpring(() => ({\n    from: {\n      height: 0\n    },\n    config: {\n      precision: 0.01,\n      mass: 1,\n      tension: 200,\n      friction: 25,\n      clamp: true\n    }\n  }));\n  useMount(() => {\n    if (!visible) return;\n    const inner = innerRef.current;\n    if (!inner) return;\n    api.start({\n      height: inner.offsetHeight,\n      immediate: true\n    });\n  });\n  useIsomorphicUpdateLayoutEffect(() => {\n    const inner = innerRef.current;\n    if (!inner) return;\n\n    if (visible) {\n      api.start({\n        height: inner.offsetHeight\n      });\n    } else {\n      api.start({\n        height: inner.offsetHeight,\n        immediate: true\n      });\n      api.start({\n        height: 0\n      });\n    }\n  }, [visible]);\n  return React.createElement(animated.div, {\n    className: `${classPrefix}-panel-content`,\n    style: {\n      height: height.to(v => {\n        if (height.idle && visible) {\n          return 'auto';\n        } else {\n          return v;\n        }\n      })\n    }\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-panel-content-inner`,\n    ref: innerRef\n  }, React.createElement(List.Item, null, shouldRender && props.children)));\n};\n\nexport const Collapse = props => {\n  var _a;\n\n  const panels = [];\n  React.Children.forEach(props.children, child => {\n    if (!React.isValidElement(child)) return;\n    const key = child.key;\n    if (typeof key !== 'string') return;\n    panels.push(child);\n  });\n  const [activeKey, setActiveKey] = usePropsValue(props.accordion ? {\n    value: props.activeKey === undefined ? undefined : props.activeKey === null ? [] : [props.activeKey],\n    defaultValue: props.defaultActiveKey === undefined || props.defaultActiveKey === null ? [] : [props.defaultActiveKey],\n    onChange: v => {\n      var _a, _b;\n\n      (_a = props.onChange) === null || _a === void 0 ? void 0 : _a.call(props, (_b = v[0]) !== null && _b !== void 0 ? _b : null);\n    }\n  } : {\n    value: props.activeKey,\n    defaultValue: (_a = props.defaultActiveKey) !== null && _a !== void 0 ? _a : [],\n    onChange: props.onChange\n  });\n  const activeKeyList = activeKey === null ? [] : Array.isArray(activeKey) ? activeKey : [activeKey];\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix\n  }, React.createElement(List, null, panels.map(panel => {\n    const key = panel.key;\n    const active = activeKeyList.includes(key);\n\n    function handleClick(event) {\n      var _a, _b;\n\n      if (props.accordion) {\n        if (active) {\n          setActiveKey([]);\n        } else {\n          setActiveKey([key]);\n        }\n      } else {\n        if (active) {\n          setActiveKey(activeKeyList.filter(v => v !== key));\n        } else {\n          setActiveKey([...activeKeyList, key]);\n        }\n      }\n\n      (_b = (_a = panel.props).onClick) === null || _b === void 0 ? void 0 : _b.call(_a, event);\n    }\n\n    const renderArrow = () => {\n      let arrow = React.createElement(DownOutline, null);\n\n      if (props.arrow !== undefined) {\n        arrow = props.arrow;\n      }\n\n      if (panel.props.arrow !== undefined) {\n        arrow = panel.props.arrow;\n      }\n\n      return typeof arrow === 'function' ? arrow(active) : React.createElement(\"div\", {\n        className: classNames(`${classPrefix}-arrow`, {\n          [`${classPrefix}-arrow-active`]: active\n        })\n      }, arrow);\n    };\n\n    return React.createElement(React.Fragment, {\n      key: key\n    }, withNativeProps(panel.props, React.createElement(List.Item, {\n      className: `${classPrefix}-panel-header`,\n      onClick: handleClick,\n      disabled: panel.props.disabled,\n      arrow: renderArrow()\n    }, panel.props.title)), React.createElement(CollapsePanelContent, {\n      visible: active,\n      forceRender: !!panel.props.forceRender,\n      destroyOnClose: !!panel.props.destroyOnClose\n    }, panel.props.children));\n  }))));\n};"]},"metadata":{},"sourceType":"module"}