{"ast":null,"code":"import React, { forwardRef, useImperativeHandle, useRef, useState } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { useDrag } from '@use-gesture/react';\nimport { useSpring, animated } from '@react-spring/web';\nimport { supportsPassive } from '../../utils/supports-passive';\nimport { nearest } from '../../utils/nearest';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { useLockScroll } from '../../utils/use-lock-scroll';\nimport { useMemoizedFn } from 'ahooks';\nconst defaultProps = {\n  handleDraggingOfContent: true\n};\nexport const FloatingPanel = forwardRef((p, ref) => {\n  var _a, _b;\n\n  const props = mergeProps(defaultProps, p);\n  const {\n    anchors\n  } = props;\n  const maxHeight = (_a = anchors[anchors.length - 1]) !== null && _a !== void 0 ? _a : window.innerHeight;\n  const possibles = anchors.map(x => -x);\n  const elementRef = useRef(null);\n  const headerRef = useRef(null);\n  const contentRef = useRef(null);\n  const [pulling, setPulling] = useState(false);\n  const pullingRef = useRef(false);\n  const bounds = {\n    top: possibles[possibles.length - 1],\n    bottom: possibles[0]\n  };\n  const onHeightChange = useMemoizedFn((_b = props.onHeightChange) !== null && _b !== void 0 ? _b : () => {});\n  const [{\n    y\n  }, api] = useSpring(() => ({\n    y: bounds.bottom,\n    config: {\n      tension: 300\n    },\n    onChange: result => {\n      onHeightChange(result.value.y, y.isAnimating);\n    }\n  }));\n  useDrag(state => {\n    const [, offsetY] = state.offset;\n\n    if (state.first) {\n      const target = state.event.target;\n      const header = headerRef.current;\n\n      if (header === target || (header === null || header === void 0 ? void 0 : header.contains(target))) {\n        pullingRef.current = true;\n      } else {\n        if (!props.handleDraggingOfContent) return;\n        const reachedTop = y.goal <= bounds.top;\n        const content = contentRef.current;\n        if (!content) return;\n\n        if (reachedTop) {\n          if (content.scrollTop <= 0 && state.direction[1] > 0) {\n            pullingRef.current = true;\n          }\n        } else {\n          pullingRef.current = true;\n        }\n      }\n    }\n\n    setPulling(pullingRef.current);\n    if (!pullingRef.current) return;\n    const {\n      event\n    } = state;\n\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n\n    event.stopPropagation();\n    let nextY = offsetY;\n\n    if (state.last) {\n      pullingRef.current = false;\n      setPulling(false);\n      nextY = nearest(possibles, offsetY);\n    }\n\n    api.start({\n      y: nextY\n    });\n  }, {\n    axis: 'y',\n    bounds,\n    rubberband: true,\n    from: () => [0, y.get()],\n    pointer: {\n      touch: true\n    },\n    target: elementRef,\n    eventOptions: supportsPassive ? {\n      passive: false\n    } : false\n  });\n  useImperativeHandle(ref, () => ({\n    setHeight: (height, options) => {\n      api.start({\n        y: -height,\n        immediate: options === null || options === void 0 ? void 0 : options.immediate\n      });\n    }\n  }), [api]);\n  useLockScroll(elementRef, true);\n  return withNativeProps(props, React.createElement(animated.div, {\n    ref: elementRef,\n    className: 'adm-floating-panel',\n    style: {\n      height: maxHeight,\n      translateY: y.to(y => `calc(100% + (${y}px))`)\n    }\n  }, React.createElement(\"div\", {\n    className: 'adm-floating-panel-mask',\n    style: {\n      display: pulling ? 'block' : 'none'\n    }\n  }), React.createElement(\"div\", {\n    className: 'adm-floating-panel-header',\n    ref: headerRef\n  }, React.createElement(\"div\", {\n    className: 'adm-floating-panel-bar'\n  })), React.createElement(\"div\", {\n    className: 'adm-floating-panel-content',\n    ref: contentRef\n  }, props.children)));\n});","map":{"version":3,"sources":["D:/react/project0330/node_modules/antd-mobile/es/components/floating-panel/floating-panel.js"],"names":["React","forwardRef","useImperativeHandle","useRef","useState","withNativeProps","useDrag","useSpring","animated","supportsPassive","nearest","mergeProps","useLockScroll","useMemoizedFn","defaultProps","handleDraggingOfContent","FloatingPanel","p","ref","_a","_b","props","anchors","maxHeight","length","window","innerHeight","possibles","map","x","elementRef","headerRef","contentRef","pulling","setPulling","pullingRef","bounds","top","bottom","onHeightChange","y","api","config","tension","onChange","result","value","isAnimating","state","offsetY","offset","first","target","event","header","current","contains","reachedTop","goal","content","scrollTop","direction","cancelable","preventDefault","stopPropagation","nextY","last","start","axis","rubberband","from","get","pointer","touch","eventOptions","passive","setHeight","height","options","immediate","createElement","div","className","style","translateY","to","display","children"],"mappings":"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","sourcesContent":["import React, { forwardRef, useImperativeHandle, useRef, useState } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { useDrag } from '@use-gesture/react';\nimport { useSpring, animated } from '@react-spring/web';\nimport { supportsPassive } from '../../utils/supports-passive';\nimport { nearest } from '../../utils/nearest';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { useLockScroll } from '../../utils/use-lock-scroll';\nimport { useMemoizedFn } from 'ahooks';\nconst defaultProps = {\n  handleDraggingOfContent: true\n};\nexport const FloatingPanel = forwardRef((p, ref) => {\n  var _a, _b;\n\n  const props = mergeProps(defaultProps, p);\n  const {\n    anchors\n  } = props;\n  const maxHeight = (_a = anchors[anchors.length - 1]) !== null && _a !== void 0 ? _a : window.innerHeight;\n  const possibles = anchors.map(x => -x);\n  const elementRef = useRef(null);\n  const headerRef = useRef(null);\n  const contentRef = useRef(null);\n  const [pulling, setPulling] = useState(false);\n  const pullingRef = useRef(false);\n  const bounds = {\n    top: possibles[possibles.length - 1],\n    bottom: possibles[0]\n  };\n  const onHeightChange = useMemoizedFn((_b = props.onHeightChange) !== null && _b !== void 0 ? _b : () => {});\n  const [{\n    y\n  }, api] = useSpring(() => ({\n    y: bounds.bottom,\n    config: {\n      tension: 300\n    },\n    onChange: result => {\n      onHeightChange(result.value.y, y.isAnimating);\n    }\n  }));\n  useDrag(state => {\n    const [, offsetY] = state.offset;\n\n    if (state.first) {\n      const target = state.event.target;\n      const header = headerRef.current;\n\n      if (header === target || (header === null || header === void 0 ? void 0 : header.contains(target))) {\n        pullingRef.current = true;\n      } else {\n        if (!props.handleDraggingOfContent) return;\n        const reachedTop = y.goal <= bounds.top;\n        const content = contentRef.current;\n        if (!content) return;\n\n        if (reachedTop) {\n          if (content.scrollTop <= 0 && state.direction[1] > 0) {\n            pullingRef.current = true;\n          }\n        } else {\n          pullingRef.current = true;\n        }\n      }\n    }\n\n    setPulling(pullingRef.current);\n    if (!pullingRef.current) return;\n    const {\n      event\n    } = state;\n\n    if (event.cancelable) {\n      event.preventDefault();\n    }\n\n    event.stopPropagation();\n    let nextY = offsetY;\n\n    if (state.last) {\n      pullingRef.current = false;\n      setPulling(false);\n      nextY = nearest(possibles, offsetY);\n    }\n\n    api.start({\n      y: nextY\n    });\n  }, {\n    axis: 'y',\n    bounds,\n    rubberband: true,\n    from: () => [0, y.get()],\n    pointer: {\n      touch: true\n    },\n    target: elementRef,\n    eventOptions: supportsPassive ? {\n      passive: false\n    } : false\n  });\n  useImperativeHandle(ref, () => ({\n    setHeight: (height, options) => {\n      api.start({\n        y: -height,\n        immediate: options === null || options === void 0 ? void 0 : options.immediate\n      });\n    }\n  }), [api]);\n  useLockScroll(elementRef, true);\n  return withNativeProps(props, React.createElement(animated.div, {\n    ref: elementRef,\n    className: 'adm-floating-panel',\n    style: {\n      height: maxHeight,\n      translateY: y.to(y => `calc(100% + (${y}px))`)\n    }\n  }, React.createElement(\"div\", {\n    className: 'adm-floating-panel-mask',\n    style: {\n      display: pulling ? 'block' : 'none'\n    }\n  }), React.createElement(\"div\", {\n    className: 'adm-floating-panel-header',\n    ref: headerRef\n  }, React.createElement(\"div\", {\n    className: 'adm-floating-panel-bar'\n  })), React.createElement(\"div\", {\n    className: 'adm-floating-panel-content',\n    ref: contentRef\n  }, props.children)));\n});"]},"metadata":{},"sourceType":"module"}