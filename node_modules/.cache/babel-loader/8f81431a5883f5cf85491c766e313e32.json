{"ast":null,"code":"import React, { useMemo, useRef } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport classNames from 'classnames';\nimport Ticks from './ticks';\nimport Marks from './marks';\nimport Thumb from './thumb';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { nearest } from '../../utils/nearest';\nimport { usePropsValue } from '../../utils/use-props-value';\nconst classPrefix = `adm-slider`;\nconst defaultProps = {\n  min: 0,\n  max: 100,\n  step: 1,\n  ticks: false,\n  range: false,\n  disabled: false\n};\nexport const Slider = p => {\n  var _a;\n\n  const props = mergeProps(defaultProps, p);\n  const {\n    min,\n    max,\n    disabled,\n    marks,\n    ticks,\n    step,\n    icon\n  } = props;\n\n  function sortValue(val) {\n    return val.sort((a, b) => a - b);\n  }\n\n  function convertValue(value) {\n    return props.range ? value : [props.min, value];\n  }\n\n  function reverseValue(value) {\n    return props.range ? value : value[1];\n  }\n\n  function onAfterChange(value) {\n    var _a;\n\n    (_a = props.onAfterChange) === null || _a === void 0 ? void 0 : _a.call(props, reverseValue(value));\n  }\n\n  const [rawValue, setRawValue] = usePropsValue({\n    value: props.value,\n    defaultValue: (_a = props.defaultValue) !== null && _a !== void 0 ? _a : props.range ? [min, min] : min,\n    onChange: props.onChange\n  });\n  const sliderValue = sortValue(convertValue(rawValue));\n\n  function setSliderValue(value) {\n    const next = sortValue(value);\n    const current = sliderValue;\n    if (next[0] === current[0] && next[1] === current[1]) return;\n    setRawValue(reverseValue(next));\n  }\n\n  const trackRef = useRef(null);\n  const fillSize = `${100 * (sliderValue[1] - sliderValue[0]) / (max - min)}%`;\n  const fillStart = `${100 * (sliderValue[0] - min) / (max - min)}%`; // 计算要显示的点\n\n  const pointList = useMemo(() => {\n    if (marks) {\n      return Object.keys(marks).map(parseFloat).sort((a, b) => a - b);\n    } else {\n      const points = [];\n\n      for (let i = min; i <= max; i += step) {\n        points.push(i);\n      }\n\n      return points;\n    }\n  }, [marks, ticks, step, min, max]);\n\n  function getValueByPosition(position) {\n    const newPosition = position < min ? min : position > max ? max : position;\n    let value = min; // 显示了刻度点，就只能移动到点上\n\n    if (pointList.length) {\n      value = nearest(pointList, newPosition);\n    } else {\n      const lengthPerStep = 100 / ((max - min) / step);\n      const steps = Math.round(newPosition / lengthPerStep);\n      value = steps * lengthPerStep * (max - min) * 0.01 + min;\n    }\n\n    return value;\n  }\n\n  const dragLockRef = useRef(0);\n\n  const onTrackClick = event => {\n    if (dragLockRef.current > 0) return;\n    event.stopPropagation();\n    if (disabled) return;\n    const track = trackRef.current;\n    if (!track) return;\n    const sliderOffsetLeft = track.getBoundingClientRect().left;\n    const position = (event.clientX - sliderOffsetLeft) / Math.ceil(track.offsetWidth) * (max - min) + min;\n    const targetValue = getValueByPosition(position);\n    let nextSliderValue;\n\n    if (props.range) {\n      // 移动的滑块采用就近原则\n      if (Math.abs(targetValue - sliderValue[0]) > Math.abs(targetValue - sliderValue[1])) {\n        nextSliderValue = [sliderValue[0], targetValue];\n      } else {\n        nextSliderValue = [targetValue, sliderValue[1]];\n      }\n    } else {\n      nextSliderValue = [props.min, targetValue];\n    }\n\n    setSliderValue(nextSliderValue);\n    onAfterChange(nextSliderValue);\n  };\n\n  const valueBeforeDragRef = useRef();\n\n  const renderThumb = index => {\n    return React.createElement(Thumb, {\n      icon: icon,\n      key: index,\n      value: sliderValue[index],\n      min: min,\n      max: max,\n      disabled: disabled,\n      trackRef: trackRef,\n      onDrag: (position, first, last) => {\n        if (first) {\n          dragLockRef.current += 1;\n          valueBeforeDragRef.current = sliderValue;\n        }\n\n        const val = getValueByPosition(position);\n        const valueBeforeDrag = valueBeforeDragRef.current;\n        if (!valueBeforeDrag) return;\n        const next = [...valueBeforeDrag];\n        next[index] = val;\n        setSliderValue(next);\n\n        if (last) {\n          onAfterChange(next);\n          window.setTimeout(() => {\n            dragLockRef.current -= 1;\n          }, 100);\n        }\n      }\n    });\n  };\n\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, {\n      [`${classPrefix}-disabled`]: disabled\n    })\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-track-container`,\n    onClick: onTrackClick\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-track`,\n    onClick: onTrackClick,\n    ref: trackRef\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-fill`,\n    style: {\n      width: fillSize,\n      left: fillStart\n    }\n  }), props.ticks && React.createElement(Ticks, {\n    points: pointList,\n    min: min,\n    max: max,\n    lowerBound: sliderValue[0],\n    upperBound: sliderValue[1]\n  }), props.range && renderThumb(0), renderThumb(1))), marks && React.createElement(Marks, {\n    min: min,\n    max: max,\n    marks: marks,\n    lowerBound: sliderValue[0],\n    upperBound: sliderValue[1]\n  })));\n};","map":{"version":3,"sources":["D:/react/project0330/node_modules/antd-mobile/es/components/slider/slider.js"],"names":["React","useMemo","useRef","withNativeProps","classNames","Ticks","Marks","Thumb","mergeProps","nearest","usePropsValue","classPrefix","defaultProps","min","max","step","ticks","range","disabled","Slider","p","_a","props","marks","icon","sortValue","val","sort","a","b","convertValue","value","reverseValue","onAfterChange","call","rawValue","setRawValue","defaultValue","onChange","sliderValue","setSliderValue","next","current","trackRef","fillSize","fillStart","pointList","Object","keys","map","parseFloat","points","i","push","getValueByPosition","position","newPosition","length","lengthPerStep","steps","Math","round","dragLockRef","onTrackClick","event","stopPropagation","track","sliderOffsetLeft","getBoundingClientRect","left","clientX","ceil","offsetWidth","targetValue","nextSliderValue","abs","valueBeforeDragRef","renderThumb","index","createElement","key","onDrag","first","last","valueBeforeDrag","window","setTimeout","className","onClick","ref","style","width","lowerBound","upperBound"],"mappings":"AAAA,OAAOA,KAAP,IAAgBC,OAAhB,EAAyBC,MAAzB,QAAuC,OAAvC;AACA,SAASC,eAAT,QAAgC,0BAAhC;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,SAASC,UAAT,QAA2B,gCAA3B;AACA,SAASC,OAAT,QAAwB,qBAAxB;AACA,SAASC,aAAT,QAA8B,6BAA9B;AACA,MAAMC,WAAW,GAAI,YAArB;AACA,MAAMC,YAAY,GAAG;AACnBC,EAAAA,GAAG,EAAE,CADc;AAEnBC,EAAAA,GAAG,EAAE,GAFc;AAGnBC,EAAAA,IAAI,EAAE,CAHa;AAInBC,EAAAA,KAAK,EAAE,KAJY;AAKnBC,EAAAA,KAAK,EAAE,KALY;AAMnBC,EAAAA,QAAQ,EAAE;AANS,CAArB;AAQA,OAAO,MAAMC,MAAM,GAAGC,CAAC,IAAI;AACzB,MAAIC,EAAJ;;AAEA,QAAMC,KAAK,GAAGd,UAAU,CAACI,YAAD,EAAeQ,CAAf,CAAxB;AACA,QAAM;AACJP,IAAAA,GADI;AAEJC,IAAAA,GAFI;AAGJI,IAAAA,QAHI;AAIJK,IAAAA,KAJI;AAKJP,IAAAA,KALI;AAMJD,IAAAA,IANI;AAOJS,IAAAA;AAPI,MAQFF,KARJ;;AAUA,WAASG,SAAT,CAAmBC,GAAnB,EAAwB;AACtB,WAAOA,GAAG,CAACC,IAAJ,CAAS,CAACC,CAAD,EAAIC,CAAJ,KAAUD,CAAC,GAAGC,CAAvB,CAAP;AACD;;AAED,WAASC,YAAT,CAAsBC,KAAtB,EAA6B;AAC3B,WAAOT,KAAK,CAACL,KAAN,GAAcc,KAAd,GAAsB,CAACT,KAAK,CAACT,GAAP,EAAYkB,KAAZ,CAA7B;AACD;;AAED,WAASC,YAAT,CAAsBD,KAAtB,EAA6B;AAC3B,WAAOT,KAAK,CAACL,KAAN,GAAcc,KAAd,GAAsBA,KAAK,CAAC,CAAD,CAAlC;AACD;;AAED,WAASE,aAAT,CAAuBF,KAAvB,EAA8B;AAC5B,QAAIV,EAAJ;;AAEA,KAACA,EAAE,GAAGC,KAAK,CAACW,aAAZ,MAA+B,IAA/B,IAAuCZ,EAAE,KAAK,KAAK,CAAnD,GAAuD,KAAK,CAA5D,GAAgEA,EAAE,CAACa,IAAH,CAAQZ,KAAR,EAAeU,YAAY,CAACD,KAAD,CAA3B,CAAhE;AACD;;AAED,QAAM,CAACI,QAAD,EAAWC,WAAX,IAA0B1B,aAAa,CAAC;AAC5CqB,IAAAA,KAAK,EAAET,KAAK,CAACS,KAD+B;AAE5CM,IAAAA,YAAY,EAAE,CAAChB,EAAE,GAAGC,KAAK,CAACe,YAAZ,MAA8B,IAA9B,IAAsChB,EAAE,KAAK,KAAK,CAAlD,GAAsDA,EAAtD,GAA2DC,KAAK,CAACL,KAAN,GAAc,CAACJ,GAAD,EAAMA,GAAN,CAAd,GAA2BA,GAFxD;AAG5CyB,IAAAA,QAAQ,EAAEhB,KAAK,CAACgB;AAH4B,GAAD,CAA7C;AAKA,QAAMC,WAAW,GAAGd,SAAS,CAACK,YAAY,CAACK,QAAD,CAAb,CAA7B;;AAEA,WAASK,cAAT,CAAwBT,KAAxB,EAA+B;AAC7B,UAAMU,IAAI,GAAGhB,SAAS,CAACM,KAAD,CAAtB;AACA,UAAMW,OAAO,GAAGH,WAAhB;AACA,QAAIE,IAAI,CAAC,CAAD,CAAJ,KAAYC,OAAO,CAAC,CAAD,CAAnB,IAA0BD,IAAI,CAAC,CAAD,CAAJ,KAAYC,OAAO,CAAC,CAAD,CAAjD,EAAsD;AACtDN,IAAAA,WAAW,CAACJ,YAAY,CAACS,IAAD,CAAb,CAAX;AACD;;AAED,QAAME,QAAQ,GAAGzC,MAAM,CAAC,IAAD,CAAvB;AACA,QAAM0C,QAAQ,GAAI,GAAE,OAAOL,WAAW,CAAC,CAAD,CAAX,GAAiBA,WAAW,CAAC,CAAD,CAAnC,KAA2CzB,GAAG,GAAGD,GAAjD,CAAsD,GAA1E;AACA,QAAMgC,SAAS,GAAI,GAAE,OAAON,WAAW,CAAC,CAAD,CAAX,GAAiB1B,GAAxB,KAAgCC,GAAG,GAAGD,GAAtC,CAA2C,GAAhE,CAhDyB,CAgD2C;;AAEpE,QAAMiC,SAAS,GAAG7C,OAAO,CAAC,MAAM;AAC9B,QAAIsB,KAAJ,EAAW;AACT,aAAOwB,MAAM,CAACC,IAAP,CAAYzB,KAAZ,EAAmB0B,GAAnB,CAAuBC,UAAvB,EAAmCvB,IAAnC,CAAwC,CAACC,CAAD,EAAIC,CAAJ,KAAUD,CAAC,GAAGC,CAAtD,CAAP;AACD,KAFD,MAEO;AACL,YAAMsB,MAAM,GAAG,EAAf;;AAEA,WAAK,IAAIC,CAAC,GAAGvC,GAAb,EAAkBuC,CAAC,IAAItC,GAAvB,EAA4BsC,CAAC,IAAIrC,IAAjC,EAAuC;AACrCoC,QAAAA,MAAM,CAACE,IAAP,CAAYD,CAAZ;AACD;;AAED,aAAOD,MAAP;AACD;AACF,GAZwB,EAYtB,CAAC5B,KAAD,EAAQP,KAAR,EAAeD,IAAf,EAAqBF,GAArB,EAA0BC,GAA1B,CAZsB,CAAzB;;AAcA,WAASwC,kBAAT,CAA4BC,QAA5B,EAAsC;AACpC,UAAMC,WAAW,GAAGD,QAAQ,GAAG1C,GAAX,GAAiBA,GAAjB,GAAuB0C,QAAQ,GAAGzC,GAAX,GAAiBA,GAAjB,GAAuByC,QAAlE;AACA,QAAIxB,KAAK,GAAGlB,GAAZ,CAFoC,CAEnB;;AAEjB,QAAIiC,SAAS,CAACW,MAAd,EAAsB;AACpB1B,MAAAA,KAAK,GAAGtB,OAAO,CAACqC,SAAD,EAAYU,WAAZ,CAAf;AACD,KAFD,MAEO;AACL,YAAME,aAAa,GAAG,OAAO,CAAC5C,GAAG,GAAGD,GAAP,IAAcE,IAArB,CAAtB;AACA,YAAM4C,KAAK,GAAGC,IAAI,CAACC,KAAL,CAAWL,WAAW,GAAGE,aAAzB,CAAd;AACA3B,MAAAA,KAAK,GAAG4B,KAAK,GAAGD,aAAR,IAAyB5C,GAAG,GAAGD,GAA/B,IAAsC,IAAtC,GAA6CA,GAArD;AACD;;AAED,WAAOkB,KAAP;AACD;;AAED,QAAM+B,WAAW,GAAG5D,MAAM,CAAC,CAAD,CAA1B;;AAEA,QAAM6D,YAAY,GAAGC,KAAK,IAAI;AAC5B,QAAIF,WAAW,CAACpB,OAAZ,GAAsB,CAA1B,EAA6B;AAC7BsB,IAAAA,KAAK,CAACC,eAAN;AACA,QAAI/C,QAAJ,EAAc;AACd,UAAMgD,KAAK,GAAGvB,QAAQ,CAACD,OAAvB;AACA,QAAI,CAACwB,KAAL,EAAY;AACZ,UAAMC,gBAAgB,GAAGD,KAAK,CAACE,qBAAN,GAA8BC,IAAvD;AACA,UAAMd,QAAQ,GAAG,CAACS,KAAK,CAACM,OAAN,GAAgBH,gBAAjB,IAAqCP,IAAI,CAACW,IAAL,CAAUL,KAAK,CAACM,WAAhB,CAArC,IAAqE1D,GAAG,GAAGD,GAA3E,IAAkFA,GAAnG;AACA,UAAM4D,WAAW,GAAGnB,kBAAkB,CAACC,QAAD,CAAtC;AACA,QAAImB,eAAJ;;AAEA,QAAIpD,KAAK,CAACL,KAAV,EAAiB;AACf;AACA,UAAI2C,IAAI,CAACe,GAAL,CAASF,WAAW,GAAGlC,WAAW,CAAC,CAAD,CAAlC,IAAyCqB,IAAI,CAACe,GAAL,CAASF,WAAW,GAAGlC,WAAW,CAAC,CAAD,CAAlC,CAA7C,EAAqF;AACnFmC,QAAAA,eAAe,GAAG,CAACnC,WAAW,CAAC,CAAD,CAAZ,EAAiBkC,WAAjB,CAAlB;AACD,OAFD,MAEO;AACLC,QAAAA,eAAe,GAAG,CAACD,WAAD,EAAclC,WAAW,CAAC,CAAD,CAAzB,CAAlB;AACD;AACF,KAPD,MAOO;AACLmC,MAAAA,eAAe,GAAG,CAACpD,KAAK,CAACT,GAAP,EAAY4D,WAAZ,CAAlB;AACD;;AAEDjC,IAAAA,cAAc,CAACkC,eAAD,CAAd;AACAzC,IAAAA,aAAa,CAACyC,eAAD,CAAb;AACD,GAxBD;;AA0BA,QAAME,kBAAkB,GAAG1E,MAAM,EAAjC;;AAEA,QAAM2E,WAAW,GAAGC,KAAK,IAAI;AAC3B,WAAO9E,KAAK,CAAC+E,aAAN,CAAoBxE,KAApB,EAA2B;AAChCiB,MAAAA,IAAI,EAAEA,IAD0B;AAEhCwD,MAAAA,GAAG,EAAEF,KAF2B;AAGhC/C,MAAAA,KAAK,EAAEQ,WAAW,CAACuC,KAAD,CAHc;AAIhCjE,MAAAA,GAAG,EAAEA,GAJ2B;AAKhCC,MAAAA,GAAG,EAAEA,GAL2B;AAMhCI,MAAAA,QAAQ,EAAEA,QANsB;AAOhCyB,MAAAA,QAAQ,EAAEA,QAPsB;AAQhCsC,MAAAA,MAAM,EAAE,CAAC1B,QAAD,EAAW2B,KAAX,EAAkBC,IAAlB,KAA2B;AACjC,YAAID,KAAJ,EAAW;AACTpB,UAAAA,WAAW,CAACpB,OAAZ,IAAuB,CAAvB;AACAkC,UAAAA,kBAAkB,CAAClC,OAAnB,GAA6BH,WAA7B;AACD;;AAED,cAAMb,GAAG,GAAG4B,kBAAkB,CAACC,QAAD,CAA9B;AACA,cAAM6B,eAAe,GAAGR,kBAAkB,CAAClC,OAA3C;AACA,YAAI,CAAC0C,eAAL,EAAsB;AACtB,cAAM3C,IAAI,GAAG,CAAC,GAAG2C,eAAJ,CAAb;AACA3C,QAAAA,IAAI,CAACqC,KAAD,CAAJ,GAAcpD,GAAd;AACAc,QAAAA,cAAc,CAACC,IAAD,CAAd;;AAEA,YAAI0C,IAAJ,EAAU;AACRlD,UAAAA,aAAa,CAACQ,IAAD,CAAb;AACA4C,UAAAA,MAAM,CAACC,UAAP,CAAkB,MAAM;AACtBxB,YAAAA,WAAW,CAACpB,OAAZ,IAAuB,CAAvB;AACD,WAFD,EAEG,GAFH;AAGD;AACF;AA3B+B,KAA3B,CAAP;AA6BD,GA9BD;;AAgCA,SAAOvC,eAAe,CAACmB,KAAD,EAAQtB,KAAK,CAAC+E,aAAN,CAAoB,KAApB,EAA2B;AACvDQ,IAAAA,SAAS,EAAEnF,UAAU,CAACO,WAAD,EAAc;AACjC,OAAE,GAAEA,WAAY,WAAhB,GAA6BO;AADI,KAAd;AADkC,GAA3B,EAI3BlB,KAAK,CAAC+E,aAAN,CAAoB,KAApB,EAA2B;AAC5BQ,IAAAA,SAAS,EAAG,GAAE5E,WAAY,kBADE;AAE5B6E,IAAAA,OAAO,EAAEzB;AAFmB,GAA3B,EAGA/D,KAAK,CAAC+E,aAAN,CAAoB,KAApB,EAA2B;AAC5BQ,IAAAA,SAAS,EAAG,GAAE5E,WAAY,QADE;AAE5B6E,IAAAA,OAAO,EAAEzB,YAFmB;AAG5B0B,IAAAA,GAAG,EAAE9C;AAHuB,GAA3B,EAIA3C,KAAK,CAAC+E,aAAN,CAAoB,KAApB,EAA2B;AAC5BQ,IAAAA,SAAS,EAAG,GAAE5E,WAAY,OADE;AAE5B+E,IAAAA,KAAK,EAAE;AACLC,MAAAA,KAAK,EAAE/C,QADF;AAELyB,MAAAA,IAAI,EAAExB;AAFD;AAFqB,GAA3B,CAJA,EAUCvB,KAAK,CAACN,KAAN,IAAehB,KAAK,CAAC+E,aAAN,CAAoB1E,KAApB,EAA2B;AAC5C8C,IAAAA,MAAM,EAAEL,SADoC;AAE5CjC,IAAAA,GAAG,EAAEA,GAFuC;AAG5CC,IAAAA,GAAG,EAAEA,GAHuC;AAI5C8E,IAAAA,UAAU,EAAErD,WAAW,CAAC,CAAD,CAJqB;AAK5CsD,IAAAA,UAAU,EAAEtD,WAAW,CAAC,CAAD;AALqB,GAA3B,CAVhB,EAgBCjB,KAAK,CAACL,KAAN,IAAe4D,WAAW,CAAC,CAAD,CAhB3B,EAgBgCA,WAAW,CAAC,CAAD,CAhB3C,CAHA,CAJ2B,EAuBuBtD,KAAK,IAAIvB,KAAK,CAAC+E,aAAN,CAAoBzE,KAApB,EAA2B;AACvFO,IAAAA,GAAG,EAAEA,GADkF;AAEvFC,IAAAA,GAAG,EAAEA,GAFkF;AAGvFS,IAAAA,KAAK,EAAEA,KAHgF;AAIvFqE,IAAAA,UAAU,EAAErD,WAAW,CAAC,CAAD,CAJgE;AAKvFsD,IAAAA,UAAU,EAAEtD,WAAW,CAAC,CAAD;AALgE,GAA3B,CAvBhC,CAAR,CAAtB;AA8BD,CA3KM","sourcesContent":["import React, { useMemo, useRef } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport classNames from 'classnames';\nimport Ticks from './ticks';\nimport Marks from './marks';\nimport Thumb from './thumb';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { nearest } from '../../utils/nearest';\nimport { usePropsValue } from '../../utils/use-props-value';\nconst classPrefix = `adm-slider`;\nconst defaultProps = {\n  min: 0,\n  max: 100,\n  step: 1,\n  ticks: false,\n  range: false,\n  disabled: false\n};\nexport const Slider = p => {\n  var _a;\n\n  const props = mergeProps(defaultProps, p);\n  const {\n    min,\n    max,\n    disabled,\n    marks,\n    ticks,\n    step,\n    icon\n  } = props;\n\n  function sortValue(val) {\n    return val.sort((a, b) => a - b);\n  }\n\n  function convertValue(value) {\n    return props.range ? value : [props.min, value];\n  }\n\n  function reverseValue(value) {\n    return props.range ? value : value[1];\n  }\n\n  function onAfterChange(value) {\n    var _a;\n\n    (_a = props.onAfterChange) === null || _a === void 0 ? void 0 : _a.call(props, reverseValue(value));\n  }\n\n  const [rawValue, setRawValue] = usePropsValue({\n    value: props.value,\n    defaultValue: (_a = props.defaultValue) !== null && _a !== void 0 ? _a : props.range ? [min, min] : min,\n    onChange: props.onChange\n  });\n  const sliderValue = sortValue(convertValue(rawValue));\n\n  function setSliderValue(value) {\n    const next = sortValue(value);\n    const current = sliderValue;\n    if (next[0] === current[0] && next[1] === current[1]) return;\n    setRawValue(reverseValue(next));\n  }\n\n  const trackRef = useRef(null);\n  const fillSize = `${100 * (sliderValue[1] - sliderValue[0]) / (max - min)}%`;\n  const fillStart = `${100 * (sliderValue[0] - min) / (max - min)}%`; // 计算要显示的点\n\n  const pointList = useMemo(() => {\n    if (marks) {\n      return Object.keys(marks).map(parseFloat).sort((a, b) => a - b);\n    } else {\n      const points = [];\n\n      for (let i = min; i <= max; i += step) {\n        points.push(i);\n      }\n\n      return points;\n    }\n  }, [marks, ticks, step, min, max]);\n\n  function getValueByPosition(position) {\n    const newPosition = position < min ? min : position > max ? max : position;\n    let value = min; // 显示了刻度点，就只能移动到点上\n\n    if (pointList.length) {\n      value = nearest(pointList, newPosition);\n    } else {\n      const lengthPerStep = 100 / ((max - min) / step);\n      const steps = Math.round(newPosition / lengthPerStep);\n      value = steps * lengthPerStep * (max - min) * 0.01 + min;\n    }\n\n    return value;\n  }\n\n  const dragLockRef = useRef(0);\n\n  const onTrackClick = event => {\n    if (dragLockRef.current > 0) return;\n    event.stopPropagation();\n    if (disabled) return;\n    const track = trackRef.current;\n    if (!track) return;\n    const sliderOffsetLeft = track.getBoundingClientRect().left;\n    const position = (event.clientX - sliderOffsetLeft) / Math.ceil(track.offsetWidth) * (max - min) + min;\n    const targetValue = getValueByPosition(position);\n    let nextSliderValue;\n\n    if (props.range) {\n      // 移动的滑块采用就近原则\n      if (Math.abs(targetValue - sliderValue[0]) > Math.abs(targetValue - sliderValue[1])) {\n        nextSliderValue = [sliderValue[0], targetValue];\n      } else {\n        nextSliderValue = [targetValue, sliderValue[1]];\n      }\n    } else {\n      nextSliderValue = [props.min, targetValue];\n    }\n\n    setSliderValue(nextSliderValue);\n    onAfterChange(nextSliderValue);\n  };\n\n  const valueBeforeDragRef = useRef();\n\n  const renderThumb = index => {\n    return React.createElement(Thumb, {\n      icon: icon,\n      key: index,\n      value: sliderValue[index],\n      min: min,\n      max: max,\n      disabled: disabled,\n      trackRef: trackRef,\n      onDrag: (position, first, last) => {\n        if (first) {\n          dragLockRef.current += 1;\n          valueBeforeDragRef.current = sliderValue;\n        }\n\n        const val = getValueByPosition(position);\n        const valueBeforeDrag = valueBeforeDragRef.current;\n        if (!valueBeforeDrag) return;\n        const next = [...valueBeforeDrag];\n        next[index] = val;\n        setSliderValue(next);\n\n        if (last) {\n          onAfterChange(next);\n          window.setTimeout(() => {\n            dragLockRef.current -= 1;\n          }, 100);\n        }\n      }\n    });\n  };\n\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, {\n      [`${classPrefix}-disabled`]: disabled\n    })\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-track-container`,\n    onClick: onTrackClick\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-track`,\n    onClick: onTrackClick,\n    ref: trackRef\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-fill`,\n    style: {\n      width: fillSize,\n      left: fillStart\n    }\n  }), props.ticks && React.createElement(Ticks, {\n    points: pointList,\n    min: min,\n    max: max,\n    lowerBound: sliderValue[0],\n    upperBound: sliderValue[1]\n  }), props.range && renderThumb(0), renderThumb(1))), marks && React.createElement(Marks, {\n    min: min,\n    max: max,\n    marks: marks,\n    lowerBound: sliderValue[0],\n    upperBound: sliderValue[1]\n  })));\n};"]},"metadata":{},"sourceType":"module"}